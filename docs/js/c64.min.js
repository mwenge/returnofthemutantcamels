var C64Joystick=function(){this.settingsDialog=null;this.portEnabled=[false,false];this.mousePortEnabled=[false,false];this.joystickKeys=[[false,false,false,false,false,false,false,false,false,false],[false,"arrowup",false,"arrowleft","arrowright",false,"arrowdown",false,"z","x"]];this.joystickButtons=[1,1];this.joystickButtonActions=[["fire","up"],["fire","up"]],this.buttonMapping=[C64_JOYSTICK_FIRE,C64_JOYSTICK_FIRE,C64_JOYSTICK_FIRE,C64_JOYSTICK_FIRE,C64_JOYSTICK_FIRE,C64_JOYSTICK_FIRE,C64_JOYSTICK_FIRE,C64_JOYSTICK_FIRE,false,false,false,false,C64_JOYSTICK_UP,C64_JOYSTICK_DOWN,C64_JOYSTICK_LEFT,C64_JOYSTICK_RIGHT];this.dialogJoystickKeys=[];this.dialogPortEnabled=[];this.dialogJoystickButtons=[];this.dialogJoystickButtonActions=[["fire","up"],["fire","up"]];this.dialogGamepadPortEnabled=[];this.defaultGamepadPort=1;this.gamepads={}};C64Joystick.prototype={hasMouse:function(){return this.mousePortEnabled[0]||this.mousePortEnabled[1]},init:function(){var n=this;if(typeof UI!="undefined"){UI.on("ready",function(){n.loadPrefs()})}else{}var n=this;window.addEventListener("gamepadconnected",function(e){var t=[];for(var a=0;a<16;a++){t[a]=false}n.gamepads[e.gamepad.id]={port:false,index:e.gamepad.index,up:false,down:false,left:false,right:false,buttons:t}});window.addEventListener("gamepaddisconnected",function(e){delete n.gamepads[e.gamepad.id]})},loadPrefs:function(){for(var e=0;e<2;e++){var t=g_app.getPref("c64joystickportenabled-"+e);if(typeof t!="undefined"&&t!==null){if(t==="false"||t=="undefined"){t=false}if(t==="true"){t=true}this.setPortEnabled(e+1,t)}else if(e==1){this.setPortEnabled(2,true)}var a=g_app.getPref("c64joystickbuttons-"+e);if(typeof a=="undefined"||a==null){a=1}this.setJoystickButtons(e,a);var n=g_app.getPref("c64joystickbuttonaction-"+e+"_1");if(typeof n=="undefined"||n==null){n="up"}this.setJoystickButtonAction(e,1,n);for(var r=0;r<this.joystickKeys[e].length;r++){var s=g_app.getPref("c64joystickkey-"+e+"-"+r);if(typeof s!="undefined"&&s!==null){if(s==="false"){s=false}this.joystickKeys[e][r]=s}}var t=g_app.getPref("c64mouseportenabled-"+e);if(typeof t!="undefined"&&t!==null){if(t==="false"||t=="undefined"){t=false}if(t==="true"){t=true}this.setMousePortEnabled(e+1,t)}}},savePrefs:function(){for(var e=0;e<2;e++){g_app.setPref("c64joystickportenabled-"+e,this.portEnabled[e]);g_app.setPref("c64mouseportenabled-"+e,this.mousePortEnabled[e]);var t=g_app.getPref("c64joystickbuttons-"+e);if(typeof t=="undefined"||t==null){t=1}g_app.setPref("c64joystickbuttons"+e,this.joystickButtons[e]);g_app.setPref("c64joystickbuttonaction-"+e+"_1",this.joystickButtonActions[e][1]);for(var a=0;a<this.joystickKeys[e].length;a++){g_app.setPref("c64joystickkey-"+e+"-"+a,this.joystickKeys[e][a])}}},hasGamepad:function(){for(var e in this.gamepads){return true}return false},setMousePortEnabled:function(e,t){if(e==1){this.mousePortEnabled[0]=t;c64_setMousePortEnabled(0,t?1:0);if(typeof UI!="undefined"){if(UI.exists("c64-mouse1")){UI("c64-mouse1").setChecked(t);UI("c64debugger-mouse1").setChecked(t)}g_app.setPref("c64mouseportenabled-0",this.mousePortEnabled[0])}}if(e==2){this.mousePortEnabled[1]=t;c64_setMousePortEnabled(1,t?1:0);if(typeof UI!="undefined"){if(UI.exists("c64-mouse2")){UI("c64-mouse2").setChecked(t);UI("c64debugger-mouse2").setChecked(t)}g_app.setPref("c64mouseportenabled-1",this.mousePortEnabled[1])}}},getMousePortEnabled:function(e){return this.mousePortEnabled[e]},setPortEnabled:function(e,t){if(e==1){this.portEnabled[0]=t;if(typeof UI!="undefined"){if(UI.exists("c64-joystick1")){UI("c64-joystick1").setChecked(t);UI("c64debugger-joystick1").setChecked(t)}g_app.setPref("c64joystickportenabled-0",this.portEnabled[0])}}if(e==2){this.portEnabled[1]=t;if(typeof UI!="undefined"){if(UI.exists("c64-joystick2")){UI("c64-joystick2").setChecked(t);UI("c64debugger-joystick2").setChecked(t)}g_app.setPref("c64joystickportenabled-1",this.portEnabled[1])}}if(typeof g_app!="undefined"&&g_app.c64Debugger){g_app.c64Debugger.updateJoystickInfo()}},swap:function(){var e=this.portEnabled[0];this.setPortEnabled(1,this.portEnabled[1]);this.setPortEnabled(2,e);for(var t=0;t<this.joystickKeys[0].length;t++){var a=this.joystickKeys[0][t];this.joystickKeys[0][t]=this.joystickKeys[1][t];this.joystickKeys[1][t]=a}this.savePrefs()},buildSettingsDialog:function(){var t=this;var e=630;var a=500;this.settingsDialog=UI.create("UI.Dialog",{id:"c64JoystickSettings",title:"Joystick Settings",width:e,height:a});var n="";n="<div>";n+='<div style="margin-bottom: 10px">';n+="<h3>Joystick Settings</h3>";n+="<div>To set a key, click on a direction and then type the key, or delete to clear.</div>";n+="<div>If a gamepad is connected, it will be used for an enabled port.</div>";n+="</div>";n+='<div style="position: relative">';for(var r=0;r<2;r++){var s=r+1;var i=0+280*r;n+='<div style="display: inline-block; position: absolute; left: '+i+"px; ";if(r==1){n+="border-left: 1px solid #333333; padding-left: 30px"}n+='">';n+='<h3 style="border: 0">Port '+s+"</h3>";n+='<div class="formGroup">';n+='  <label class="cb-container">Enabled';n+='  <input type="checkbox" id="c64JoystickSettingsPortEnabled_'+r+'" name="c64JoystickSettingsPortEnabled" value="'+r+'">';n+='    <span class="checkmark"></span>';n+="  </label>";n+="</div>";n+='<div class="formGroup">';n+='  <label class="rb-container" style="margin-right: 8px; margin-bottom: 0">1 Button';n+='  <input type="radio" checked="checked" id="c64JoystickSettingsButtons_'+r+'_1" name="c64JoystickSettingsButtons_'+r+'" value="1">';n+='    <span class="checkmark"></span>';n+="  </label>";n+='  <label class="rb-container" style="margin-bottom: 0px">2 Button';n+='  <input type="radio" id="c64JoystickSettingsButtons_'+r+'_2" name="c64JoystickSettingsButtons_'+r+'" value="2">';n+='    <span class="checkmark"></span>';n+="  </label>";n+="</div>";n+='<div class="formGroup">';n+="  <label>Button 2 Action:</label>";n+='  <label class="rb-container" style="margin-right: 8px">Up';n+='  <input type="radio" checked="checked" id="c64JoystickSettingsButton2Action_'+r+'_Up" name="c64JoystickSettingsButton2Action_'+r+'" value="up">';n+='    <span class="checkmark"></span>';n+="  </label>";n+='  <label class="rb-container">Space Bar';n+='  <input type="radio" id="c64JoystickSettingsButton2Action_'+r+'_Space" name="c64JoystickSettingsButton2Action_'+r+'" value="space">';n+='    <span class="checkmark"></span>';n+="  </label>";n+="</div>";n+='<div class="formGroup">';n+="<div>Keys</div>";var o=0;n+="<table>";for(var c=0;c<3;c++){n+="<tr>";for(var l=0;l<3;l++){n+='<td style="padding: 4px">';if(c!=1||l!=1){n+='<div tabindex="'+o+'" data-keyindex="'+o+'" data-port="'+r+'" id="c64JoystickSettings'+r+"_"+o+'" class="c64JoystickSettingsKey" ';n+=' style="text-align: center; width: 68px; height: 28px; background-color: #eeeeee; border: 2px solid transparent; color: #444444">ArrowUp</div>';o++}n+="</td>"}n+="</tr>"}n+="<tr>";n+='<td colspan="3" style="padding: 3px;">';n+='<div style="display: inline-block; margin-right: 10px">Button 1</div>';n+='<div tabindex="'+o+'" data-keyindex="'+o+'" data-port="'+r+'" id="c64JoystickSettings'+r+"_"+o+'" class="c64JoystickSettingsKey" ';n+=' style="text-align: center; display: inline-block; width: 68px; height: 28px; background-color: #eeeeee; border: 2px solid transparent; color: #444444">';n+="ArrowUp";n+="</div>";o++;n+="</td>";n+="</tr>";n+="<tr>";n+='<td colspan="3" style="padding: 3px;">';n+='<div style="display: inline-block; margin-right: 10px">Button 2</div>';n+='<div tabindex="'+o+'" data-keyindex="'+o+'" data-port="'+r+'" id="c64JoystickSettings'+r+"_"+o+'" class="c64JoystickSettingsKey" ';n+=' style="text-align: center; display: inline-block; width: 68px; height: 28px; background-color: #eeeeee; border: 2px solid transparent; color: #444444">';n+="ArrowUp";n+="</div>";o++;n+="</td>";n+="</tr>";n+="</table>";n+="</div>";n+="</div>"}n+="</div>";n+="</div>";var d=UI.create("UI.HTMLPanel",{html:n});this.settingsDialog.add(d);this.okButton=UI.create("UI.Button",{text:"OK",color:"primary"});this.okButton.on("click",function(e){t.saveDialogButtons();UI.closeDialog()});this.closeButton=UI.create("UI.Button",{text:"Cancel",color:"secondary"});this.closeButton.on("click",function(e){UI.closeDialog()});this.settingsDialog.addButton(this.okButton);this.settingsDialog.addButton(this.closeButton);this.initEvents();this.updateContent()},initEvents:function(){var n=this;$(".c64JoystickSettingsKey").on("keydown",function(e){var t=parseInt($(this).attr("data-port"),10);var a=parseInt($(this).attr("data-keyindex"),10);if(e.key.toLowerCase()=="delete"||e.key.toLowerCase()=="backspace"){n.dialogJoystickKeys[t][a]=false}else{n.dialogJoystickKeys[t][a]=e.key.toLowerCase()}n.updateContent();e.preventDefault()});$(".c64JoystickSettingsKey").on("click",function(){$(this).focus()});$(".c64JoystickSettingsKey").on("focus",function(){$(".c64JoystickSettingsKey").css("border","2px solid transparent");$(".c64JoystickSettingsKey").css("color","#444444");$(this).css("border","2px solid #99aaff");$(".c64JoystickSettingsKey").css("color","#222222")});$(".c64JoystickSettingsKey").on("blur",function(){$(".c64JoystickSettingsKey").css("border","2px solid transparent");$(".c64JoystickSettingsKey").css("color","#444444")});$("input[name=c64JoystickSettingsPortEnabled]").on("click",function(){var e=parseInt($(this).val());n.dialogPortEnabled[e]=$(this).is(":checked")});$("input[name=c64JoystickSettingsGamepadPortEnabled]").on("click",function(){var e=parseInt($(this).val());n.dialogGamepadPortEnabled[e]=$(this).is(":checked")});$("input[name=c64JoystickSettingsButtons_0").on("click",function(){var e=parseInt($("input[name=c64JoystickSettingsButtons_0]:checked").val(),10);n.dialogJoystickButtons[0]=e});$("input[name=c64JoystickSettingsButtons_1").on("click",function(){var e=parseInt($("input[name=c64JoystickSettingsButtons_1]:checked").val(),10);n.dialogJoystickButtons[1]=e});$("input[name=c64JoystickSettingsButton2Action_0").on("click",function(){var e=$("input[name=c64JoystickSettingsButton2Action_0]:checked").val();n.dialogJoystickButtonActions[0][1]=e});$("input[name=c64JoystickSettingsButton2Action_1").on("click",function(){var e=$("input[name=c64JoystickSettingsButton2Action_1]:checked").val();n.dialogJoystickButtonActions[1][1]=e})},updateContent:function(){for(var e=0;e<2;e++){$("#c64JoystickSettingsPortEnabled_"+e).prop("checked",this.dialogPortEnabled[e]);if(this.dialogJoystickButtons[e]==2){$("#c64JoystickSettingsButtons_"+e+"_2").prop("checked",true)}else{$("#c64JoystickSettingsButtons_"+e+"_1").prop("checked",true)}if(this.dialogJoystickButtonActions[e][1]=="space"){$("#c64JoystickSettingsButton2Action_"+e+"_Space").prop("checked",true)}else{$("#c64JoystickSettingsButton2Action_"+e+"_Up").prop("checked",true)}for(var t=0;t<this.dialogJoystickKeys[e].length;t++){var a=this.dialogJoystickKeys[e][t];if(a===false){a=""}if(a===" "){a="space"}$("#c64JoystickSettings"+e+"_"+t).html(a)}}},showSettingsDialog:function(){this.dialogJoystickKeys=[];for(var e=0;e<2;e++){var t=[];for(var a=0;a<this.joystickKeys[e].length;a++){t.push(this.joystickKeys[e][a])}this.dialogJoystickKeys.push(t)}for(var e=0;e<2;e++){this.dialogPortEnabled[e]=this.portEnabled[e];this.dialogJoystickButtons[e]=this.joystickButtons[e];this.dialogJoystickButtonActions[e][1]=this.joystickButtonActions[e][1]}if(this.settingsDialog==null){this.buildSettingsDialog()}UI.showDialog("c64JoystickSettings");this.updateContent()},saveDialogButtons:function(){for(var e=0;e<2;e++){for(var t=0;t<this.joystickKeys[e].length;t++){this.joystickKeys[e][t]=this.dialogJoystickKeys[e][t];var a="c64joystickkey-"+e+"-"+t;console.log("set pref: "+a+" to "+this.joystickKeys[e][t]);g_app.setPref(a,this.joystickKeys[e][t])}}for(var e=0;e<2;e++){this.setPortEnabled(e+1,this.dialogPortEnabled[e]);g_app.setPref("c64joystickportenabled-"+e,this.dialogPortEnabled[e]);this.setJoystickButtons(e,this.dialogJoystickButtons[e]);g_app.setPref("c64joystickbuttons-"+e,this.dialogJoystickButtons[e]);this.setJoystickButtonAction(e,1,this.dialogJoystickButtonActions[e][1]);g_app.setPref("c64joystickbuttonaction-"+e+"_1",this.dialogJoystickButtonActions[e][1])}if(typeof g_app!="undefined"&&g_app.c64Debugger){g_app.c64Debugger.updateJoystickInfo()}},setJoystickButtons:function(e,t){this.joystickButtons[e]=t},getJoystickButtons:function(e){return this.joystickButtons[e]},setJoystickButtonAction:function(e,t,a){if(typeof a=="undefined"||a=="undefined"){this.joystickButtonActions[e][t]="up"}else{this.joystickButtonActions[e][t]=a}},getJoystickButtonAction:function(e,t){return this.joystickButtonActions[e][t]},gamepadIsActive:function(){if(typeof g_app!="undefined"&&g_app.c64Debugger){g_app.c64Debugger.hideOnscreenJoystick()}if(typeof overlayOnscreenJoystick!="undefined"&&overlayOnscreenJoystick!=null){overlayOnscreenJoystick.setHidden(true)}},checkGamepads:function(){var e=navigator.getGamepads();if(e.length==0){return}if(e[0]==null||typeof e[0].axes=="undefined"){return}for(var t in this.gamepads){var a=e[this.gamepads[t].index];var n=this.gamepads[t].port;for(var r=0;r<this.portEnabled.length;r++){if(this.portEnabled[r]){this.gamepads[t].port=r;n=r;if(a.axes[0]<=-.5){if(!this.gamepads[t].left){c64_joystickPush(n,C64_JOYSTICK_LEFT);this.gamepadIsActive();this.gamepads[t].left=true}}else{if(this.gamepads[t].left){c64_joystickRelease(n,C64_JOYSTICK_LEFT);this.gamepads[t].left=false}}if(a.axes[0]>=.5){if(!this.gamepads[t].right){c64_joystickPush(n,C64_JOYSTICK_RIGHT);this.gamepadIsActive();this.gamepads[t].right=true}}else{if(this.gamepads[t].right){c64_joystickRelease(n,C64_JOYSTICK_RIGHT);this.gamepads[t].right=false}}if(a.axes[1]<=-.5){if(!this.gamepads[t].up){c64_joystickPush(n,C64_JOYSTICK_UP);this.gamepadIsActive();this.gamepads[t].up=true}}else{if(this.gamepads[t].up){c64_joystickRelease(n,C64_JOYSTICK_UP);this.gamepads[t].up=false}}if(a.axes[1]>=.5){if(!this.gamepads[t].down){c64_joystickPush(n,C64_JOYSTICK_DOWN);this.gamepadIsActive();this.gamepads[t].down=true}}else{if(this.gamepads[t].down){c64_joystickRelease(n,C64_JOYSTICK_DOWN);this.gamepads[t].down=false}}if(typeof a.buttons!="undefined"){for(var s=0;s<this.buttonMapping.length;s++){if(a.buttons.length>s&&this.buttonMapping[s]!==false){var i=this.buttonMapping[s];if(this.joystickButtons[n]==2&&i==C64_JOYSTICK_FIRE){if(s==1||s==3){if(this.getJoystickButtonAction(n,1)=="up"){i=C64_JOYSTICK_UP}if(this.getJoystickButtonAction(n,1)=="space"){i="space"}}}if(a.buttons[s].pressed){if(!this.gamepads[t].buttons[s]){if(i=="space"){c64_keyPressed(C64_KEY_SPACE)}else{c64_joystickPush(n,i);this.gamepadIsActive()}this.gamepads[t].buttons[s]=true}}else{if(this.gamepads[t].buttons[s]){if(i=="space"){c64_keyReleased(C64_KEY_SPACE)}else{c64_joystickRelease(n,i)}this.gamepads[t].buttons[s]=false}}}}}}}}},keyDown:function(e){var t=1;e.preventDefault();var a=e.key.toLowerCase();for(var n=0;n<=1;n++){if(this.portEnabled[n]){switch(a){case this.joystickKeys[n][0]:return true;break;case this.joystickKeys[n][1]:c64_joystickPush(n,C64_JOYSTICK_UP);return true;break;case this.joystickKeys[n][2]:return true;break;case this.joystickKeys[n][3]:c64_joystickPush(n,C64_JOYSTICK_LEFT);return true;break;case this.joystickKeys[n][4]:c64_joystickPush(n,C64_JOYSTICK_RIGHT);return true;break;case this.joystickKeys[n][5]:return true;break;case this.joystickKeys[n][6]:c64_joystickPush(n,C64_JOYSTICK_DOWN);return true;break;case this.joystickKeys[n][7]:return true;break;case this.joystickKeys[n][8]:c64_joystickPush(n,C64_JOYSTICK_FIRE);return true;break;case this.joystickKeys[n][9]:if(this.joystickButtons[n]>1){if(this.joystickButtonActions[n][1]=="space"){c64_keyPressed(C64_KEY_SPACE)}else{c64_joystickPush(n,C64_JOYSTICK_UP)}return true}break}}}return false},keyUp:function(e){var t=1;e.preventDefault();var a=e.key.toLowerCase();for(var n=0;n<=1;n++){if(this.portEnabled[n]){switch(a){case this.joystickKeys[n][0]:return true;break;case this.joystickKeys[n][1]:c64_joystickRelease(n,C64_JOYSTICK_UP);return true;break;case this.joystickKeys[n][2]:return true;break;case this.joystickKeys[n][3]:c64_joystickRelease(n,C64_JOYSTICK_LEFT);return true;break;case this.joystickKeys[n][4]:c64_joystickRelease(n,C64_JOYSTICK_RIGHT);return true;break;case this.joystickKeys[n][5]:return true;break;case this.joystickKeys[n][6]:c64_joystickRelease(n,C64_JOYSTICK_DOWN);return true;break;case this.joystickKeys[n][7]:return true;break;case this.joystickKeys[n][8]:c64_joystickRelease(n,C64_JOYSTICK_FIRE);return true;break;case this.joystickKeys[n][9]:if(this.joystickButtons[n]>1){if(this.joystickButtonActions[n][1]=="space"){c64_keyReleased(C64_KEY_SPACE)}else{c64_joystickRelease(n,C64_JOYSTICK_UP)}return true}break}}}return false}};C64_JOYSTICK_UP=1;C64_JOYSTICK_DOWN=2;C64_JOYSTICK_LEFT=4;C64_JOYSTICK_RIGHT=8;C64_JOYSTICK_FIRE=16;function elementOffset(e){var t=e.getBoundingClientRect(),a=window.pageXOffset||document.documentElement.scrollLeft,n=window.pageYOffset||document.documentElement.scrollTop;return{top:t.top+n,left:t.left+a}}var C64OnscreenJoystick=function(){this.debugger=null;this.button1X=0;this.button1Y=0;this.button1Radius=0;this.button2X=0;this.button2Y=0;this.button2Radius=0;this.joystickX=0;this.joystickY=0;this.joystickRadius1=0;this.joystickRadius2=0;this.maxRadius=100;this.button1Down=false;this.button2Down=false;this.joystickDirectionDown=false;this.port=2;this.twoButton=false;this.button2Function="up";this.canvas=null;this.id="c64-onscreen-joystick";this.showPortSelection=false;this.hidden=false};C64OnscreenJoystick.prototype={init:function(e){this.debugger=e.debugger;this.debugger.setOnscreenJoystickPort(2);this.port=2;if(typeof e.id!="undefined"){this.id=e.id}if(typeof e.showPortSelection!="undefined"){this.showPortSelection=e.showPortSelection}},setHidden:function(e){this.hidden=e;this.draw()},getHTML:function(e){var t=1;if(typeof e!="undefined"){if(typeof e.opacity!="undefined"){t=e.opacity}}var a="";a+='<div id="'+this.id+'" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0">';if(this.showPortSelection){a+="  <div>";a+='    <label class="rb-container" style="margin-right: 4px">Port 1';a+='      <input type="radio" id="mobileC64JoystickPort1" name="mobileC64JoystickPort" value="1">';a+='      <span class="checkmark"></span>';a+="    </label>";a+='    <label class="rb-container" style="margin-right: 4px">Port 2';a+='      <input type="radio" id="mobileC64JoystickPort2" name="mobileC64JoystickPort" checked="checked"  value="2">';a+='      <span class="checkmark"></span>';a+="    </label>";a+="  </div>"}a+='  <canvas id="'+this.id+'-canvas"';if(t!=1){a+=' style="';a+=" opacity: "+t+";";a+=" position: absolute; left: 2px; bottom: 40px; ";a+='"'}a+="></canvas>";a+="</div>";return a},buildInterface:function(e){var t=this.getHTML();this.uiComponent=UI.create("UI.HTMLPanel",{id:"c64OnscreenJoystick",html:t});e.add(this.uiComponent);var a=this;UI.on("ready",function(){a.initEvents()})},initEvents:function(){var a=this;var a=this;this.canvas=document.getElementById(this.id+"-canvas");this.canvas.addEventListener("contextmenu",function(e){e.preventDefault()},false);this.canvas.addEventListener("touchstart",function(e){e.preventDefault();a.touchStart(e)},false);this.canvas.addEventListener("touchmove",function(e){e.preventDefault();a.touchMove(e);return false},false);this.canvas.addEventListener("touchend",function(e){e.preventDefault();a.touchEnd(e)},false);if(this.showPortSelection){if(typeof $!="undefined"){$("input[name=mobileC64JoystickPort]").on("click",function(e){var t=$("input[name=mobileC64JoystickPort]:checked").val();t=parseInt(t,10);if(!isNaN(t)){a.port=t}a.debugger.setJoystickPort(t)})}}},setPort:function(e){this.port=e},setType:function(e){switch(e){case 1:this.twoButton=false;break;case 2:this.twoButton=true;break}this.draw()},setSecondButton:function(e){this.button2Function=e},processButtonTouches:function(e){var t=false;var a=false;for(var n=0;n<e.length;n++){var r=e[n];var s=r.pageX-elementOffset(this.canvas).left;var i=r.pageY-elementOffset(this.canvas).top;var o=(this.button1X-s)*(this.button1X-s)+(this.button1Y-i)*(this.button1Y-i);if(o<this.button1Radius*this.button1Radius){t=true}var o=(this.button2X-s)*(this.button2X-s)+(this.button2Y-i)*(this.button2Y-i);if(o<this.button2Radius*this.button2Radius){a=true}}if(t!=this.button1Down){this.button1Down=t;if(this.button1Down){this.joystickPush("fire")}else{this.joystickRelease("fire")}}if(a!=this.button2Down){this.button2Down=a;switch(this.button2Function){case"space":if(this.button2Down){c64_keyPressed(C64_KEY_SPACE)}else{c64_keyReleased(C64_KEY_SPACE)}break;case"up":if(this.button2Down){this.joystickPush("up")}else{this.joystickRelease("up")}break}}},processJoystickTouches:function(e){var t=this.joystickDirectionDown;this.joystickDirectionDown=false;for(var a=0;a<e.length;a++){var n=e[a];var r=n.pageX-elementOffset(this.canvas).left;var s=n.pageY-elementOffset(this.canvas).top;var i=(this.joystickX-r)*(this.joystickX-r)+(this.joystickY-s)*(this.joystickY-s);i=Math.sqrt(i);if(i>this.joystickRadius1&&i<this.joystickRadius2){var o=Math.atan((s-this.joystickY)/(r-this.joystickX));if(r>=this.joystickX){o+=Math.PI/2}else{o+=Math.PI+Math.PI/2}for(var c=0;c<8;c++){var l=-(2*Math.PI/16)+c*(2*Math.PI/8);var d=l+2*Math.PI/8;if(l<0){l+=Math.PI*2;if(o>l||o<d){this.joystickDirectionDown=c;break}}else{if(o>l&&o<d){this.joystickDirectionDown=c;break}}}}}if(this.joystickDirectionDown!==t){switch(t){case 0:this.joystickRelease("up");break;case 1:this.joystickRelease("up");this.joystickRelease("right");break;case 2:this.joystickRelease("right");break;case 3:this.joystickRelease("right");this.joystickRelease("down");break;case 4:this.joystickRelease("down");break;case 5:this.joystickRelease("down");this.joystickRelease("left");break;case 6:this.joystickRelease("left");break;case 7:this.joystickRelease("left");this.joystickRelease("up");break}switch(this.joystickDirectionDown){case 0:this.joystickPush("up");break;case 1:this.joystickPush("up");this.joystickPush("right");break;case 2:this.joystickPush("right");break;case 3:this.joystickPush("down");this.joystickPush("right");break;case 4:this.joystickPush("down");break;case 5:this.joystickPush("down");this.joystickPush("left");break;case 6:this.joystickPush("left");break;case 7:this.joystickPush("up");this.joystickPush("left");break}}},touchStart:function(e){this.hidden=false;this.processButtonTouches(e.touches);this.processJoystickTouches(e.touches);this.draw()},touchMove:function(e){this.processButtonTouches(e.touches);this.processJoystickTouches(e.touches);this.draw()},touchEnd:function(e){this.processButtonTouches(e.touches);this.processJoystickTouches(e.touches);this.draw()},joystickPush:function(e){switch(e){case"up":c64_joystickPush(this.port-1,C64_JOYSTICK_UP);break;case"down":c64_joystickPush(this.port-1,C64_JOYSTICK_DOWN);break;case"left":c64_joystickPush(this.port-1,C64_JOYSTICK_LEFT);break;case"right":c64_joystickPush(this.port-1,C64_JOYSTICK_RIGHT);break;case"fire":c64_joystickPush(this.port-1,C64_JOYSTICK_FIRE);break}},joystickRelease:function(e){switch(e){case"up":c64_joystickRelease(this.port-1,C64_JOYSTICK_UP);break;case"down":c64_joystickRelease(this.port-1,C64_JOYSTICK_DOWN);break;case"left":c64_joystickRelease(this.port-1,C64_JOYSTICK_LEFT);break;case"right":c64_joystickRelease(this.port-1,C64_JOYSTICK_RIGHT);break;case"fire":c64_joystickRelease(this.port-1,C64_JOYSTICK_FIRE);break}},layout:function(){var e=document.getElementById(this.id);if(!e){return}if(this.canvas==null){return}var t=e.clientWidth-4;this.canvas.width=t;this.joystickRadius1=44;this.joystickRadius2=80;if(this.joystickRadius2>this.maxRadius){this.joystickRadius2=this.maxRadius;if(this.joystickRadius2-this.joystickRadius1<30){this.joystickRadius1=this.joystickRadius2-30}}var a=0;if(this.showPortSelection){a=30}this.joystickX=this.joystickRadius2+20;this.canvas.height=2*this.joystickRadius2+20;var n=this.canvas.height/2;this.joystickY=n;if(this.twoButton){var r=t-40;var s=30;this.button2X=r;this.button2Y=n-20;this.button2Radius=s;this.button1X=r-s*2.2;this.button1Y=n-20+1.8*s;this.button1Radius=s}else{this.button1X=t-70;this.button1Y=n;this.button1Radius=40}var i=Math.floor(5*(e.clientHeight-a-this.canvas.height)/8);if(i<0){i=0}this.canvas.style.marginTop="18px"},draw:function(){this.layout();if(this.canvas==null){return}this.context=this.canvas.getContext("2d");var e=document.getElementById(this.id);if(!e){console.log("no holder");return}var t=e.clientWidth-4;this.canvas.width=t;this.context=this.canvas.getContext("2d");this.context.clearRect(0,0,this.canvas.width,this.canvas.height);if(this.hidden){return}this.context.fillStyle="#ee1111";if(this.button1Down){this.context.fillStyle="#991111"}this.context.beginPath();this.context.arc(this.button1X,this.button1Y,this.button1Radius,0,2*Math.PI);this.context.fill();if(this.twoButton){this.context.fillStyle="#ee1111";if(this.button2Down){this.context.fillStyle="#991111"}this.context.beginPath();this.context.arc(this.button2X,this.button2Y,this.button2Radius,0,2*Math.PI);this.context.fill()}for(var a=0;a<8;a++){var n=0-Math.PI/2-2*Math.PI/16+a*(2*Math.PI/8);var r=n+2*Math.PI/8;this.context.fillStyle="#555555";if(a===this.joystickDirectionDown){this.context.fillStyle="#999999"}this.context.beginPath();this.context.arc(this.joystickX,this.joystickY,this.joystickRadius2,n,r,false);this.context.arc(this.joystickX,this.joystickY,this.joystickRadius1,r,n,true);this.context.closePath();this.context.fill()}}};var C64OnscreenKeyboard=function(){this.debugger=null;this.fontImage=null;this.fontCanvas=null;this.keyPositions=[];this.deletePosition={};this.keyIndexDown=false;this.keysDown=[];this.touchUsed=[];this.id="c64-onscreen-keyboard"};var C64_KEY_NONE=-1;C64OnscreenKeyboard.prototype={init:function(e){this.debugger=e.debugger;this.initKeyboard()},getHTML:function(){var e='<div style="text-align: center; position: absolute; top: 0; bottom: 0; left: 0; right: 0" id="'+this.id+'">';e+='<canvas id="c64OnscreenKeyboardCanvas" style="background-color: #440000"></canvas>';e+="</div>";return e},buildInterface:function(e){var t=this.getHTML();this.uiComponent=UI.create("UI.HTMLPanel",{id:"c64OnscreenKeyboard",html:t});e.add(this.uiComponent);this.initEvents();this.loadFont()},loadFont:function(){var e=this;this.fontImage=new Image;this.fontImage.onload=function(){e.createFontCanvas()};this.fontImage.src=c64keycharsImageData},createFontCanvas:function(){var e=this.fontImage.naturalWidth;var t=this.fontImage.naturalHeight;this.fontCanvas=document.createElement("canvas");this.fontCanvas.width=e;this.fontCanvas.height=t;this.fontContext=this.fontCanvas.getContext("2d");this.fontContext.drawImage(this.fontImage,0,0,e,t);this.draw()},initEvents:function(){this.canvas=document.getElementById("c64OnscreenKeyboardCanvas");if(typeof $!="undefined"){$("#c64OnscreenKeyboardCanvas").on("contextmenu",function(e){e.preventDefault()})}var t=this;this.canvas.addEventListener("contextmenu",function(e){e.preventDefault()},false);this.canvas.addEventListener("touchstart",function(e){e.preventDefault();t.touchStart(e)},false);this.canvas.addEventListener("touchmove",function(e){e.preventDefault();t.touchMove(e)},false);this.canvas.addEventListener("touchend",function(e){e.preventDefault();t.touchEnd(e)},false)},processStartTouches:function(e){var t=false;var a=[];for(var n=0;n<e.length;n++){var r=e[n];var s=r.pageX-elementOffset(this.canvas).left;var i=r.pageY-elementOffset(this.canvas).top;for(var n=0;n<this.keyPositions.length;n++){var o=this.keyPositions[n].x;var c=this.keyPositions[n].y;var l=this.keyPositions[n].width;var d=this.keyPositions[n].height;if(s>o&&s<o+l&&i>c&&i<c+d){var u=this.keyPositions[n].keyIndex;if(u===C64_KEY_SHIFT_LEFT||u===C64_KEY_SHIFT_RIGHT){t=false}a.push({keyIndex:u,identifier:r.identifier});break}}}var f=false;for(var _=0;_<this.keysDown.length;_++){if(this.keysDown[_]===C64_KEY_SHIFT_LEFT||this.keysDown[_]===C64_KEY_SHIFT_RIGHT){f=true;break}}var h=false;for(var _=0;_<this.keysDown.length;_++){if(this.keysDown[_]===C64_KEY_COMMODORE){h=true;break}}var p=false;for(var _=0;_<this.keysDown.length;_++){if(this.keysDown[_]===C64_KEY_CTRL){p=true;break}}for(var n=0;n<a.length;n++){var u=a[n].keyIndex;var g=false;var y=false;for(var _=0;_<this.keysDown.length;_++){if(this.keysDown[_]==a[n].keyIndex){g=true;y=_;break}}if(!g){this.keyDown(a[n].keyIndex);this.keysDown.push(a[n].keyIndex)}}this.releaseShiftLeft=false;this.releaseShiftRight=false;this.releaseCommodore=false;this.releaseCtrl=false;if(f){for(var _=0;_<this.keysDown.length;_++){if(this.keysDown[_]===C64_KEY_SHIFT_LEFT){this.releaseShiftLeft=true;this.keysDown.splice(_,1);_=0}if(this.keysDown[_]===C64_KEY_SHIFT_RIGHT){this.releaseShiftRight=true;this.keysDown.splice(_,1);_=0}}}if(h){for(var _=0;_<this.keysDown.length;_++){if(this.keysDown[_]===C64_KEY_COMMODORE){this.releaseCommodore=true;this.keysDown.splice(_,1);break}}}if(p){for(var _=0;_<this.keysDown.length;_++){if(this.keysDown[_]===C64_KEY_CTRL){this.releaseCtrl=true;this.keysDown.splice(_,1);break}}}},processTouches:function(e){var t=[];for(var a=0;a<e.length;a++){var n=e[a];var r=n.pageX-elementOffset(this.canvas).left;var s=n.pageY-elementOffset(this.canvas).top;for(var a=0;a<this.keyPositions.length;a++){var i=this.keyPositions[a].x;var o=this.keyPositions[a].y;var c=this.keyPositions[a].width;var l=this.keyPositions[a].height;if(r>i&&r<i+c&&s>o&&s<o+l){var d=this.keyPositions[a].keyIndex;if(d!==C64_KEY_SHIFT_LEFT&&d!==C64_KEY_SHIFT_RIGHT&&d!==C64_KEY_COMMODORE&&d!==C64_KEY_CTRL){t.push({keyIndex:d,identifier:n.identifier})}break}}}var u=[];for(var a=0;a<this.keysDown.length;a++){if(this.keysDown[a]!==C64_KEY_SHIFT_LEFT&&this.keysDown[a]!==C64_KEY_SHIFT_RIGHT&&this.keysDown[a]!==C64_KEY_COMMODORE&&this.keysDown[a]!==C64_KEY_CTRL){var f=false;for(var _=0;_<t.length;_++){if(this.keysDown[a]==t[_].keyIndex){f=true;break}}if(!f){this.keyUp(this.keysDown[a])}else{u.push(this.keysDown[a])}}else{u.push(this.keysDown[a])}}this.keysDown=u},keyDown:function(e){c64_keyPressed(e)},keyUp:function(e){c64_keyReleased(e)},touchStart:function(e){var t=e.touches;this.processStartTouches(e.changedTouches);this.draw()},touchMove:function(e){this.processTouches(e.touches);this.draw()},touchEnd:function(e){this.processTouches(e.touches);if(this.releaseCommodore){this.keyUp(C64_KEY_COMMODORE);this.releaseCommodore=false}if(this.releaseCtrl){this.keyUp(C64_KEY_CTRL);this.releaseCtrl=false}if(this.releaseShiftLeft){this.keyUp(C64_KEY_SHIFT_LEFT);this.releaseShiftLeft=false}if(this.releaseShiftRight){this.keyUp(C64_KEY_SHIFT_RIGHT);this.releaseShiftRight=false}this.draw()},initKeyboard:function(){this.petsciiKeyboardFull=[[{width:1,keyIndex:C64_KEY_ARROW_LEFT,charCode:31,shiftedCode:126,altCode:-1},{width:1,keyIndex:C64_KEY_ONE,charCode:49,shiftedCode:33,altCode:-1,colorCode:0},{width:1,keyIndex:C64_KEY_TWO,charCode:50,shiftedCode:34,altCode:-1,colorCode:1},{width:1,keyIndex:C64_KEY_THREE,charCode:51,shiftedCode:35,altCode:-1,colorCode:2},{width:1,keyIndex:C64_KEY_FOUR,charCode:52,shiftedCode:36,altCode:-1,colorCode:3},{width:1,keyIndex:C64_KEY_FIVE,charCode:53,shiftedCode:37,altCode:-1,colorCode:4},{width:1,keyIndex:C64_KEY_SIX,charCode:54,shiftedCode:38,altCode:-1,colorCode:5},{width:1,keyIndex:C64_KEY_SEVEN,charCode:55,shiftedCode:39,altCode:-1,colorCode:6},{width:1,keyIndex:C64_KEY_EIGHT,charCode:56,shiftedCode:40,altCode:-1,colorCode:7},{width:1,keyIndex:C64_KEY_NINE,charCode:57,shiftedCode:41,altCode:-1},{width:1,keyIndex:C64_KEY_ZERO,charCode:48,shiftedCode:42,altCode:-1},{width:1,keyIndex:C64_KEY_PLUS,charCode:43,shiftedCode:95,altCode:-1},{width:1,keyIndex:C64_KEY_MINUS,charCode:45,shiftedCode:43,altCode:-1},{width:1,keyIndex:C64_KEY_POUND,charCode:28,shiftedCode:43,altCode:-1},{width:1,keyIndex:C64_KEY_INS_DEL,charCode:-1,shiftedCode:-1}],[{width:1.5,keyIndex:9,charCode:-1,shiftedCode:-1,altCode:-1},{width:1,keyIndex:C64_KEY_Q,charCode:17,shiftedCode:81,altCode:195},{width:1,keyIndex:C64_KEY_W,charCode:23,shiftedCode:87,altCode:180},{width:1,keyIndex:C64_KEY_E,charCode:5,shiftedCode:69,altCode:193},{width:1,keyIndex:C64_KEY_R,charCode:18,shiftedCode:82,altCode:194},{width:1,keyIndex:C64_KEY_T,charCode:20,shiftedCode:84,altCode:204},{width:1,keyIndex:C64_KEY_Y,charCode:25,shiftedCode:89,altCode:185},{width:1,keyIndex:C64_KEY_U,charCode:21,shiftedCode:85,altCode:202},{width:1,keyIndex:C64_KEY_I,charCode:9,shiftedCode:73,altCode:203},{width:1,keyIndex:C64_KEY_O,charCode:15,shiftedCode:79,altCode:-1},{width:1,keyIndex:C64_KEY_P,charCode:16,shiftedCode:80,altCode:-1},{width:1,keyIndex:C64_KEY_AT,charCode:0,shiftedCode:123,altCode:-1},{width:1,keyIndex:C64_KEY_STAR,charCode:42,shiftedCode:125,altCode:-1},{width:1.5,keyIndex:C64_KEY_ARROW_UP,charCode:30,shiftedCode:124,altCode:-1}],[{width:1.75,keyIndex:C64_KEY_RUN_STOP,charCode:-1,shiftedCode:-1},{width:1,keyIndex:C64_KEY_A,charCode:1,shiftedCode:65,altCode:218},{width:1,keyIndex:C64_KEY_S,charCode:19,shiftedCode:83,altCode:191},{width:1,keyIndex:C64_KEY_D,charCode:4,shiftedCode:68,altCode:179},{width:1,keyIndex:C64_KEY_F,charCode:6,shiftedCode:70,altCode:196},{width:1,keyIndex:C64_KEY_G,charCode:7,shiftedCode:71,altCode:201},{width:1,keyIndex:C64_KEY_H,charCode:8,shiftedCode:72,altCode:187},{width:1,keyIndex:C64_KEY_J,charCode:10,shiftedCode:74,altCode:186},{width:1,keyIndex:C64_KEY_K,charCode:11,shiftedCode:75,altCode:205},{width:1,keyIndex:C64_KEY_L,charCode:12,shiftedCode:76,altCode:195},{width:1,keyIndex:C64_KEY_COLON,charCode:58,shiftedCode:58,altCode:195},{width:1,keyIndex:C64_KEY_SEMICOLON,charCode:59,shiftedCode:34,altCode:195},{width:1,keyIndex:C64_KEY_EQUALS,charCode:61,shiftedCode:34,altCode:195},{width:1.25,keyIndex:C64_KEY_RETURN,charCode:-1,shiftedCode:-1}],[{width:2.25,keyIndex:C64_KEY_SHIFT_LEFT,charCode:-1,shiftedCode:-1},{width:1,keyIndex:C64_KEY_Z,charCode:26,shiftedCode:90,altCode:192},{width:1,keyIndex:C64_KEY_X,charCode:24,shiftedCode:88,altCode:217},{width:1,keyIndex:C64_KEY_C,charCode:3,shiftedCode:67,altCode:197},{width:1,keyIndex:C64_KEY_V,charCode:22,shiftedCode:86,altCode:195},{width:1,keyIndex:C64_KEY_B,charCode:2,shiftedCode:66,altCode:200},{width:1,keyIndex:C64_KEY_N,charCode:14,shiftedCode:78,altCode:188},{width:1,keyIndex:C64_KEY_M,charCode:13,shiftedCode:77,altCode:206},{width:1,keyIndex:C64_KEY_COMMA,charCode:44,shiftedCode:60,altCode:195},{width:1,keyIndex:C64_KEY_PERIOD,charCode:46,shiftedCode:62,altCode:195},{width:1,keyIndex:C64_KEY_SLASH,charCode:47,shiftedCode:63,altCode:195},{width:2.75,keyIndex:C64_KEY_SHIFT_RIGHT,charCode:-1,shiftedCode:-1}],[{width:1.5,keyIndex:C64_KEY_COMMODORE,charCode:-1},{width:1.25,keyIndex:91},{width:1.5,keyIndex:18},{width:6.5,keyIndex:C64_KEY_SPACE,charCode:32,shiftedCode:32,altCode:32},{width:1.5,keyIndex:18},{width:1.25,keyIndex:92},{width:1.5,keyIndex:17}]];this.petsciiKeyboardSmall=[[{width:1,keyIndex:C64_KEY_ARROW_LEFT,charCode:31,shiftedCode:31,altCode:-1},{width:1,keyIndex:C64_KEY_ARROW_UP,charCode:30,shiftedCode:94,altCode:-1},{width:1.5,keyIndex:C64_KEY_F1,charCode:-1,shiftedCode:-1,altCode:-1,colorCode:0},{width:1.5,keyIndex:C64_KEY_F3,charCode:-1,shiftedCode:-1,altCode:-1,colorCode:1},{width:1.5,keyIndex:C64_KEY_F5,charCode:-1,shiftedCode:-1,altCode:-1,colorCode:2},{width:1.5,keyIndex:C64_KEY_F7,charCode:-1,shiftedCode:-1,altCode:-1,colorCode:3},{width:2,keyIndex:C64_KEY_RESTORE,charCode:-1,shiftedCode:-1,altCode:-1,colorCode:3},{width:2,keyIndex:C64_KEY_INS_DEL,charCode:-1,shiftedCode:-1,altCode:-1}],[{width:1,keyIndex:C64_KEY_ONE,charCode:49,shiftedCode:33,altCode:-1,colorCode:0},{width:1,keyIndex:C64_KEY_TWO,charCode:50,shiftedCode:34,altCode:-1,colorCode:1},{width:1,keyIndex:C64_KEY_THREE,charCode:51,shiftedCode:35,altCode:-1,colorCode:2},{width:1,keyIndex:C64_KEY_FOUR,charCode:52,shiftedCode:36,altCode:-1,colorCode:3},{width:1,keyIndex:C64_KEY_FIVE,charCode:53,shiftedCode:37,altCode:-1,colorCode:4},{width:1,keyIndex:C64_KEY_SIX,charCode:54,shiftedCode:38,altCode:-1,colorCode:5},{width:1,keyIndex:C64_KEY_SEVEN,charCode:55,shiftedCode:39,altCode:-1,colorCode:6},{width:1,keyIndex:C64_KEY_EIGHT,charCode:56,shiftedCode:40,altCode:-1,colorCode:7},{width:1,keyIndex:C64_KEY_NINE,charCode:57,shiftedCode:41,altCode:-1},{width:1,keyIndex:C64_KEY_ZERO,charCode:48,shiftedCode:-1,altCode:-1},{width:1,keyIndex:C64_KEY_PLUS,charCode:43,shiftedCode:91,altCode:-1},{width:1,keyIndex:C64_KEY_MINUS,charCode:45,shiftedCode:93,altCode:-1},{width:1,keyIndex:C64_KEY_POUND,charCode:28,shiftedCode:105,altCode:-1}],[{width:.5,keyIndex:C64_KEY_NONE,charCode:-1,shiftedCode:-1,altCode:-1},{width:1,keyIndex:C64_KEY_Q,charCode:17,shiftedCode:81,altCode:107},{width:1,keyIndex:C64_KEY_W,charCode:23,shiftedCode:87,altCode:115},{width:1,keyIndex:C64_KEY_E,charCode:5,shiftedCode:69,altCode:113},{width:1,keyIndex:C64_KEY_R,charCode:18,shiftedCode:82,altCode:114},{width:1,keyIndex:C64_KEY_T,charCode:20,shiftedCode:84,altCode:99},{width:1,keyIndex:C64_KEY_Y,charCode:25,shiftedCode:89,altCode:119},{width:1,keyIndex:C64_KEY_U,charCode:21,shiftedCode:85,altCode:120},{width:1,keyIndex:C64_KEY_I,charCode:9,shiftedCode:73,altCode:98},{width:1,keyIndex:C64_KEY_O,charCode:15,shiftedCode:79,altCode:121},{width:1,keyIndex:C64_KEY_P,charCode:16,shiftedCode:80,altCode:111},{width:1,keyIndex:C64_KEY_AT,charCode:0,shiftedCode:122,altCode:100},{width:1,keyIndex:C64_KEY_STAR,charCode:42,shiftedCode:70,altCode:95},{width:.5,keyIndex:C64_KEY_NONE,charCode:-1,shiftedCode:-1,altCode:-1}],[{width:1,keyIndex:C64_KEY_RUN_STOP,charCode:-1,shiftedCode:-1},{width:1,keyIndex:C64_KEY_A,charCode:1,shiftedCode:65,altCode:112},{width:1,keyIndex:C64_KEY_S,charCode:19,shiftedCode:83,altCode:110},{width:1,keyIndex:C64_KEY_D,charCode:4,shiftedCode:68,altCode:108},{width:1,keyIndex:C64_KEY_F,charCode:6,shiftedCode:70,altCode:123},{width:1,keyIndex:C64_KEY_G,charCode:7,shiftedCode:71,altCode:101},{width:1,keyIndex:C64_KEY_H,charCode:8,shiftedCode:72,altCode:116},{width:1,keyIndex:C64_KEY_J,charCode:10,shiftedCode:74,altCode:117},{width:1,keyIndex:C64_KEY_K,charCode:11,shiftedCode:75,altCode:97},{width:1,keyIndex:C64_KEY_L,charCode:12,shiftedCode:76,altCode:118},{width:1,keyIndex:C64_KEY_COLON,charCode:58,shiftedCode:27,altCode:27},{width:1,keyIndex:C64_KEY_SEMICOLON,charCode:59,shiftedCode:29,altCode:29},{width:1,keyIndex:C64_KEY_EQUALS,charCode:61,shiftedCode:61,altCode:61}],[{width:1.5,keyIndex:C64_KEY_SHIFT_LEFT,charCode:-1,shiftedCode:-1},{width:1,keyIndex:C64_KEY_Z,charCode:26,shiftedCode:90,altCode:109},{width:1,keyIndex:C64_KEY_X,charCode:24,shiftedCode:88,altCode:125},{width:1,keyIndex:C64_KEY_C,charCode:3,shiftedCode:67,altCode:124},{width:1,keyIndex:C64_KEY_V,charCode:22,shiftedCode:86,altCode:126},{width:1,keyIndex:C64_KEY_B,charCode:2,shiftedCode:66,altCode:127},{width:1,keyIndex:C64_KEY_N,charCode:14,shiftedCode:78,altCode:106},{width:1,keyIndex:C64_KEY_M,charCode:13,shiftedCode:77,altCode:103},{width:1,keyIndex:C64_KEY_COMMA,charCode:44,shiftedCode:60,altCode:60},{width:1,keyIndex:C64_KEY_PERIOD,charCode:46,shiftedCode:62,altCode:62},{width:1,keyIndex:C64_KEY_SLASH,charCode:47,shiftedCode:63,altCode:63},{width:1.5,keyIndex:C64_KEY_RETURN,charCode:-1,shiftedCode:-1}],[{width:1.5,keyIndex:C64_KEY_COMMODORE,charCode:-1},{width:1.25,keyIndex:C64_KEY_CTRL,charCode:-1},{width:6.5,keyIndex:C64_KEY_SPACE,charCode:32,shiftedCode:32,altCode:32}]];this.keyboard=this.petsciiKeyboardSmall},draw:function(){if(this.fontCanvas==null){return}var e=0;if(this.keyPositions.length==0){for(var t=0;t<256;t++){this.keyPositions[t]={x:0,y:0,width:0,height:0}}}this.context=this.canvas.getContext("2d");var a=this.keyboard;var n=8;var r=8;var s=1;var i=document.getElementById(this.id);if(!i){console.log("no holder");return}var o=i.clientWidth-4;var c=i.clientHeight-4;var l=Math.floor(o/15);if(_*s>l){_=Math.floor(l/s)}var d=Math.floor(n*1.8);var u=Math.floor(r*1.8);var f=13;var _=Math.floor(o/f);var h=_;if(h*6>c){h=Math.floor(c/6);if(_>1.35*h){_=Math.floor(1.35*h)}}if(s==1){}if(h>_){_=h}if(_<r){_=r}var p=h*7.5;var g=_*13;this.canvas.height=p*s+1;this.canvas.width=g*s+1;this.context=this.canvas.getContext("2d");this.shiftDown=false;this.commodoreDown=false;for(var t=0;t<this.keysDown.length;t++){if(this.keysDown[t]==C64_KEY_SHIFT_LEFT||this.keysDown[t]==C64_KEY_SHIFT_RIGHT){this.shiftDown=true}if(this.keysDown[t]==C64_KEY_COMMODORE){this.commodoreDown=true}}this.context.fillStyle="#151515";this.context.fillRect(0,0,this.canvas.width*s,this.canvas.height*s);this.context.fillStyle="#aaaaaa";var y=0;this.context.moveTo(0,y);for(var v=0;v<6;v++){this.context.moveTo(0,y+Math.floor(v*h*s)+.5);this.context.lineTo(g*s+1,y+Math.floor(v*h*s)+.5);var C=0;for(var t=0;t<a[v].length;t++){a[v][t].top=y+Math.floor(v*h*s)+.5;a[v][t].left=Math.floor(C*_*s)+.5;var k=false;for(var m=0;m<this.keysDown.length;m++){if(this.keysDown[m]==a[v][t].keyIndex){k=true}}if(k){this.context.fillRect(a[v][t].left,y+a[v][t].top,_*a[v][t].width*s,h*s)}this.keyPositions[e++]={x:a[v][t].left,y:y+a[v][t].top,width:_*a[v][t].width*s,height:h*s,keyIndex:a[v][t].keyIndex};this.context.moveTo(Math.floor(C*_*s)+.5,y+Math.floor(v*h*s)+.5);this.context.lineTo(Math.floor(C*_*s)+.5,y+Math.floor((v+1)*h*s)+.5);C+=a[v][t].width}this.context.moveTo(Math.floor(C*_*s)+.5,y+Math.floor(v*h*s)+.5);this.context.lineTo(Math.floor(C*_*s)+.5,y+Math.floor((v+1)*h*s)+.5)}this.context.moveTo(0,y+Math.floor(v*h*s)+.5);this.context.lineTo(g*s+1,y+Math.floor(v*h*s)+.5);this.context.strokeStyle="#333333";this.context.lineWidth=1.5;this.context.stroke();var C=13;var v=13;var b=4;var C=0;var v=0;for(var E=0;E<a.length;E++){C=0;v=E;for(var t=0;t<a[E].length;t++){var w=a[E][t].width*_*s;var I=Math.floor(C*_*s+(w-r*s)/2);var S=y+Math.floor(v*h*s+(h*s-n*s)/2);var b=this.keyboard[E][t].charCode;if(this.shiftDown){b=this.keyboard[E][t].shiftedCode}var R=false;if(this.commodoreDown){b=this.keyboard[E][t].altCode;if(b==-1&&typeof this.keyboard[E][t].colorCode!="undefined"){R=this.keyboard[E][t].colorCode;if(this.shiftDown){R+=8}}}if(typeof b=="undefined"){b=-1}if(b>=0){var K=b%16;var Y=Math.floor(b/16);var P=K*8;var T=Y*8;var x=8;var O=8;var A=I;var F=S;var B=8;var D=8;this.context.drawImage(this.fontCanvas,P,T,x,O,A,F,B,D)}else{var U=this.keyboard[E][t].keyIndex;var M=[];if(U==C64_KEY_F1||U==C64_KEY_F3||U==C64_KEY_F5||U==C64_KEY_F7){M.push(6);var b=49;switch(U){case C64_KEY_F3:b+=2;break;case C64_KEY_F5:b+=4;break;case C64_KEY_F7:b+=6;break}if(this.shiftDown){b++}M.push(b)}if(U==C64_KEY_COMMODORE){M.push(3);M.push(61)}if(U==C64_KEY_CTRL){M.push(3);M.push(20);M.push(18);M.push(12)}if(U==C64_KEY_SHIFT_LEFT){M.push(19);M.push(8);M.push(6);M.push(20)}if(U==C64_KEY_RESTORE){M.push(18);M.push(19);M.push(20);M.push(18)}if(U==C64_KEY_INS_DEL){M.push(4);M.push(5);M.push(12)}if(U==C64_KEY_RETURN){M.push(18);M.push(20);M.push(14)}if(U==C64_KEY_RUN_STOP){M.push(18);M.push(47);M.push(19)}var I=Math.floor(C*_*s+(w-M.length*r*s)/2);for(var j=0;j<M.length;j++){b=M[j];var K=b%16;var Y=Math.floor(b/16);var P=K*8;var T=Y*8;var x=8;var O=8;var A=I+j*8;var F=S;var B=8;var D=8;this.context.drawImage(this.fontCanvas,P,T,x,O,A,F,B,D)}}C+=a[E][t].width}}}};var c64keycharsImageData="data:image/png;base64,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";var C64Scripting=function(){this.scriptProcessor=null};C64Scripting.prototype={init:function(){var a=this;this.scriptProcessor=new Scripting;this.scriptProcessor.init({outputElementId:this.outputElementId});this.scriptProcessor.registerAPI(function(e,t){a.initAPI(e,t)});this.scriptProcessor.setPrescript("c64",this.apiPreScript())},getCompletions:function(e,t){var a=[];a.push({value:"c64.setColor",meta:"Set C64 Colour"});return a},apiPreScript:function(){var e="";var t=";";e+="c64.eventHandlers = {};"+t;e+="c64.on = function(eventType, callback) {"+t;e+=' Editor.on("c64." + eventType, callback);'+t;e+="}"+t;e+="c64.rasterY = function(rasterY, callback) { "+t;e+='  console.log("rastery:" + rasterY);';e+="}"+t;return e},initAPI:function(e,t){var a=this;var n=function(e){return c64_cpuRead(e)};var r=function(e,t){c64_cpuWrite(e,t)};var s=function(e,t,a,n){e=e&15;var r=t&255;r+=(a&255)<<8;r+=(n&255)<<16;r=(r>>>0)+4278190080;c64_setColor(e,r)};var i=e.createObjectProto(e.OBJECT_PROTO);e.setProperty(t,"c64",i);e.setProperty(i,"cpuWrite",e.createNativeFunction(c64_cpuWrite,false),Interpreter.NONENUMERABLE_DESCRIPTOR);e.setProperty(i,"cpuRead",e.createNativeFunction(c64_cpuRead,false),Interpreter.NONENUMERABLE_DESCRIPTOR);e.setProperty(i,"getPC",e.createNativeFunction(c64_getPC,false),Interpreter.NONENUMERABLE_DESCRIPTOR);e.setProperty(i,"setPC",e.createNativeFunction(c64_setPC,false),Interpreter.NONENUMERABLE_DESCRIPTOR);e.setProperty(i,"setColor",e.createNativeFunction(s,false),Interpreter.NONENUMERABLE_DESCRIPTOR);e.setProperty(i,"getA",e.createNativeFunction(c64_getRegA,false),Interpreter.NONENUMERABLE_DESCRIPTOR);e.setProperty(i,"setA",e.createNativeFunction(c64_setRegA,false),Interpreter.NONENUMERABLE_DESCRIPTOR);e.setProperty(i,"getX",e.createNativeFunction(c64_getRegX,false),Interpreter.NONENUMERABLE_DESCRIPTOR);e.setProperty(i,"setX",e.createNativeFunction(c64_setRegX,false),Interpreter.NONENUMERABLE_DESCRIPTOR);e.setProperty(i,"getY",e.createNativeFunction(c64_getRegY,false),Interpreter.NONENUMERABLE_DESCRIPTOR);e.setProperty(i,"setY",e.createNativeFunction(c64_setRegY,false),Interpreter.NONENUMERABLE_DESCRIPTOR);e.setProperty(i,"getRasterY",e.createNativeFunction(c64_getRasterY,false),Interpreter.NONENUMERABLE_DESCRIPTOR);e.setProperty(t,"c64Write",e.createNativeFunction(c64_cpuWrite,false),Interpreter.NONENUMERABLE_DESCRIPTOR);e.setProperty(t,"c64Read",e.createNativeFunction(c64_cpuRead,false),Interpreter.NONENUMERABLE_DESCRIPTOR);e.setProperty(t,"c64GetPC",e.createNativeFunction(c64_getPC,false),Interpreter.NONENUMERABLE_DESCRIPTOR);e.setProperty(t,"c64SetPC",e.createNativeFunction(c64_setPC,false),Interpreter.NONENUMERABLE_DESCRIPTOR);e.setProperty(t,"c64GetRegA",e.createNativeFunction(c64_getRegA,false),Interpreter.NONENUMERABLE_DESCRIPTOR);e.setProperty(t,"c64SetRegA",e.createNativeFunction(c64_setRegA,false),Interpreter.NONENUMERABLE_DESCRIPTOR);e.setProperty(t,"c64GetRegX",e.createNativeFunction(c64_getRegX,false),Interpreter.NONENUMERABLE_DESCRIPTOR);e.setProperty(t,"c64SetRegX",e.createNativeFunction(c64_setRegX,false),Interpreter.NONENUMERABLE_DESCRIPTOR);e.setProperty(t,"c64GetRegY",e.createNativeFunction(c64_getRegY,false),Interpreter.NONENUMERABLE_DESCRIPTOR);e.setProperty(t,"c64SetRegY",e.createNativeFunction(c64_setRegY,false),Interpreter.NONENUMERABLE_DESCRIPTOR);e.setProperty(t,"c64SetColor",e.createNativeFunction(s,false),Interpreter.NONENUMERABLE_DESCRIPTOR);e.setProperty(t,"c64_reset",e.createNativeFunction(c64_reset,false),Interpreter.NONENUMERABLE_DESCRIPTOR)}};var C64Sound=function(){this.audioEnabled=true};C64Sound.prototype={init:function(){this.loadPrefs()},loadPrefs:function(){if(typeof UI!="undefined"){var e=this;UI.on("ready",function(){e.setModel(g_app.getPref("c64sidmodel"))})}},checkAudio:function(){if(this.audioEnabled){this.startAudio()}},setModel:function(e){switch(e){case"6581":sid_setModel(0);if(typeof UI!="undefined"){if(UI.exists("c64debugger-sound6581")&&UI.exists("c64debugger-sound8580")){UI("c64debugger-sound6581").setChecked(true);UI("c64debugger-sound8580").setChecked(false)}g_app.setPref("c64sidmodel",e)}break;case"8580":sid_setModel(1);if(typeof UI!="undefined"){if(UI.exists("c64debugger-sound6581")&&UI.exists("c64debugger-sound8580")){UI("c64debugger-sound6581").setChecked(false);UI("c64debugger-sound8580").setChecked(true)}g_app.setPref("c64sidmodel",e)}break}},toggleAudio:function(){if(this.audioEnabled){this.stopAudio()}else{this.startAudio()}UI("c64debugger-sound").setChecked(this.audioEnabled)},getAudioEnabled:function(){return this.audioEnabled},startAudio:function(){var e=window.AudioContext||window.webkitAudioContext||false;if(!e){return}var t=this;this.stopAudio();try{this.audioBufferLength=4096;this.audioCtx=new e;this.sampleRate=this.audioCtx.sampleRate;sid_setSampleRate(this.sampleRate);this.scriptNode=this.audioCtx.createScriptProcessor(this.audioBufferLength,0,1);this.scriptNode.onaudioprocess=function(e){t.audioProcess(e)};this.scriptNode.connect(this.audioCtx.destination);this.audioEnabled=true;if(typeof UI!="undefined"){UI("c64-sound").setChecked(this.audioEnabled)}}catch(e){console.log(e);this.audioEnabled=false}},stopAudio:function(){if(this.scriptNode){this.scriptNode.disconnect(this.audioCtx.destination);this.scriptNode.onaudioprocess=null;this.scriptNode=null}if(this.audioCtx){this.audioCtx.close().catch(function(e){});this.audioCtx=null}this.audioEnabled=false;if(typeof UI!="undefined"){UI("c64-sound").setChecked(this.audioEnabled)}},audioProcess:function(e){var t=e.outputBuffer;var a=t.getChannelData(0);if(debugger_isRunning()&&!document.hidden&&this.lastUpdate!=g_lastUpdate){this.lastUpdate=g_lastUpdate;var n=sid_getAudioBuffer();var r=new Float32Array(c64.HEAPF32.subarray(n>>2,(n>>2)+this.audioBufferLength));a.set(r)}else{for(var s=0;s<this.audioBufferLength;s++){a[s]=0}}}};var C64Colors=function(){this.colors=[4278190080,4294967295,4281873281,4291350133,4288101518,4283280470,4288359470,4285657581,4280897678,4278204501,4285623492,4283058762,4286282619,4288675753,4293619056,4289901234]};C64Colors.prototype={init:function(){},setColor:function(e,t){if(isNaN(e)||e<0||e>15){return}this.colors[e]=t;if(c64_ready){c64_setColor(e,t)}},getColor:function(e){if(e<0||e>15){return}return this.colors[e]},setAllColors:function(){if(c64_ready){for(var e=0;e<16;e++){c64_setColor(e,this.colors[e])}}},resetColor:function(e){var t=[4278190080,4294967295,4281873281,4291350133,4288101518,4283280470,4288359470,4285657581,4280897678,4278204501,4285623492,4283058762,4286282619,4288675753,4293619056,4289901234];this.setColor(e,t[e])},resetColors:function(){this.colors=[4278190080,4294967295,4281873281,4291350133,4288101518,4283280470,4288359470,4285657581,4280897678,4278204501,4285623492,4283058762,4286282619,4288675753,4293619056,4289901234];this.setAllColors()}};var C64=function(){var Fn=typeof document!=="undefined"&&document.currentScript?document.currentScript.src:undefined;if(typeof __filename!=="undefined")Fn=Fn||__filename;return function(e){e=e||{};var i=typeof e!=="undefined"?e:{};var t={};var a;for(a in i){if(i.hasOwnProperty(a)){t[a]=i[a]}}var n=[];var r="./this.program";var s=function(e,t){throw t};var o=false;var c=false;var l=false;var d=false;var u=false;o=typeof window==="object";c=typeof importScripts==="function";d=typeof process==="object"&&typeof process.versions==="object"&&typeof process.versions.node==="string";l=d&&!o&&!c;u=!o&&!l&&!c;var f="";function _(e){if(i["locateFile"]){return i["locateFile"](e,f)}return f+e}var h,p,g,y;var v;var C;if(l){f=__dirname+"/";h=function e(t,a){if(!v)v=require("fs");if(!C)C=require("path");t=C["normalize"](t);return v["readFileSync"](t,a?null:"utf8")};g=function e(t){var a=h(t,true);if(!a.buffer){a=new Uint8Array(a)}j(a.buffer);return a};if(process["argv"].length>1){r=process["argv"][1].replace(/\\/g,"/")}n=process["argv"].slice(2);process["on"]("uncaughtException",function(e){if(!(e instanceof On)){throw e}});process["on"]("unhandledRejection",Me);s=function(e){process["exit"](e)};i["inspect"]=function(){return"[Emscripten Module object]"}}else if(u){if(typeof read!="undefined"){h=function e(t){return read(t)}}g=function e(t){var a;if(typeof readbuffer==="function"){return new Uint8Array(readbuffer(t))}a=read(t,"binary");j(typeof a==="object");return a};if(typeof scriptArgs!="undefined"){n=scriptArgs}else if(typeof arguments!="undefined"){n=arguments}if(typeof quit==="function"){s=function(e){quit(e)}}if(typeof print!=="undefined"){if(typeof console==="undefined")console={};console.log=print;console.warn=console.error=typeof printErr!=="undefined"?printErr:print}}else if(o||c){if(c){f=self.location.href}else if(document.currentScript){f=document.currentScript.src}if(Fn){f=Fn}if(f.indexOf("blob:")!==0){f=f.substr(0,f.lastIndexOf("/")+1)}else{f=""}{h=function e(t){var a=new XMLHttpRequest;a.open("GET",t,false);a.send(null);return a.responseText};if(c){g=function e(t){var a=new XMLHttpRequest;a.open("GET",t,false);a.responseType="arraybuffer";a.send(null);return new Uint8Array(a.response)}}p=function e(t,a,n){var r=new XMLHttpRequest;r.open("GET",t,true);r.responseType="arraybuffer";r.onload=function e(){if(r.status==200||r.status==0&&r.response){a(r.response);return}n()};r.onerror=n;r.send(null)}}y=function(e){document.title=e}}else{}var k=i["print"]||console.log.bind(console);var m=i["printErr"]||console.warn.bind(console);for(a in t){if(t.hasOwnProperty(a)){i[a]=t[a]}}t=null;if(i["arguments"])n=i["arguments"];if(i["thisProgram"])r=i["thisProgram"];if(i["quit"])s=i["quit"];var b=16;function E(e){var t=oe[he>>2];var a=t+e+15&-16;if(a>tt()){Me()}oe[he>>2]=a;return t}function w(e){switch(e){case"i1":case"i8":return 1;case"i16":return 2;case"i32":return 4;case"i64":return 8;case"float":return 4;case"double":return 8;default:{if(e[e.length-1]==="*"){return 4}else if(e[0]==="i"){var t=parseInt(e.substr(1));j(t%8===0,"getNativeTypeSize invalid bits "+t+", type "+e);return t/8}else{return 0}}}}function I(e){if(!I.shown)I.shown={};if(!I.shown[e]){I.shown[e]=1;m(e)}}function S(e,t){if(typeof WebAssembly.Function==="function"){var a={i:"i32",j:"i64",f:"f32",d:"f64"};var n={parameters:[],results:t[0]=="v"?[]:[a[t[0]]]};for(var r=1;r<t.length;++r){n.parameters.push(a[t[r]])}return new WebAssembly.Function(n,e)}var s=[1,0,1,96];var i=t.slice(0,1);var o=t.slice(1);var c={i:127,j:126,f:125,d:124};s.push(o.length);for(var r=0;r<o.length;++r){s.push(c[o[r]])}if(i=="v"){s.push(0)}else{s=s.concat([1,c[i]])}s[1]=s.length-2;var l=new Uint8Array([0,97,115,109,1,0,0,0].concat(s,[2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0]));var d=new WebAssembly.Module(l);var u=new WebAssembly.Instance(d,{e:{f:e}});var f=u.exports["f"];return f}function R(t,a){var n=D;var r=n.length;try{n.grow(1)}catch(e){if(!(e instanceof RangeError)){throw e}throw"Unable to grow wasm table. Use a higher value for RESERVED_FUNCTION_POINTERS or set ALLOW_TABLE_GROWTH."}try{n.set(r,t)}catch(e){if(!(e instanceof TypeError)){throw e}j(typeof a!=="undefined","Missing signature argument to addFunction");var s=S(t,a);n.set(r,s)}return r}function K(e){}var Y={};function P(e,t,a){if(a&&a.length){return i["dynCall_"+e].apply(null,[t].concat(a))}else{return i["dynCall_"+e].call(null,t)}}var T=0;var x=function(e){T=e};var O;if(i["wasmBinary"])O=i["wasmBinary"];var A;if(i["noExitRuntime"])A=i["noExitRuntime"];if(typeof WebAssembly!=="object"){m("no native wasm support detected")}function F(e,t,a,n){a=a||"i8";if(a.charAt(a.length-1)==="*")a="i32";switch(a){case"i1":ne[e>>0]=t;break;case"i8":ne[e>>0]=t;break;case"i16":se[e>>1]=t;break;case"i32":oe[e>>2]=t;break;case"i64":qe=[t>>>0,(Ve=t,+Pe(Ve)>=1?Ve>0?(Oe(+xe(Ve/4294967296),4294967295)|0)>>>0:~~+Te((Ve-+(~~Ve>>>0))/4294967296)>>>0:0)],oe[e>>2]=qe[0],oe[e+4>>2]=qe[1];break;case"float":le[e>>2]=t;break;case"double":de[e>>3]=t;break;default:Me("invalid type for setValue: "+a)}}var B;var D=new WebAssembly.Table({initial:220,maximum:220+0,element:"anyfunc"});var U=false;var M=0;function j(e,t){if(!e){Me("Assertion failed: "+t)}}function J(e){var t=i["_"+e];j(t,"Cannot call unknown function "+e+", make sure it is exported");return t}function N(e,t,a,n,r){var s={string:function(e){var t=0;if(e!==null&&e!==undefined&&e!==0){var a=(e.length<<2)+1;t=mn(a);G(e,t,a)}return t},array:function(e){var t=mn(e.length);Q(e,t);return t}};function i(e){if(t==="string")return q(e);if(t==="boolean")return Boolean(e);return e}var o=J(e);var c=[];var l=0;if(n){for(var d=0;d<n.length;d++){var u=s[a[d]];if(u){if(l===0)l=kn();c[d]=u(n[d])}else{c[d]=n[d]}}}var f=o.apply(null,c);f=i(f);if(l!==0)bn(l);return f}function L(e,t,a,n){a=a||[];var r=a.every(function(e){return e==="number"});var s=t!=="string";if(s&&r&&!n){return J(e)}return function(){return N(e,t,a,arguments,n)}}var H=3;var W=typeof TextDecoder!=="undefined"?new TextDecoder("utf8"):undefined;function V(e,t,a){var n=t+a;var r=t;while(e[r]&&!(r>=n))++r;if(r-t>16&&e.subarray&&W){return W.decode(e.subarray(t,r))}else{var s="";while(t<r){var i=e[t++];if(!(i&128)){s+=String.fromCharCode(i);continue}var o=e[t++]&63;if((i&224)==192){s+=String.fromCharCode((i&31)<<6|o);continue}var c=e[t++]&63;if((i&240)==224){i=(i&15)<<12|o<<6|c}else{i=(i&7)<<18|o<<12|c<<6|e[t++]&63}if(i<65536){s+=String.fromCharCode(i)}else{var l=i-65536;s+=String.fromCharCode(55296|l>>10,56320|l&1023)}}}return s}function q(e,t){return e?V(re,e,t):""}function X(e,t,a,n){if(!(n>0))return 0;var r=a;var s=a+n-1;for(var i=0;i<e.length;++i){var o=e.charCodeAt(i);if(o>=55296&&o<=57343){var c=e.charCodeAt(++i);o=65536+((o&1023)<<10)|c&1023}if(o<=127){if(a>=s)break;t[a++]=o}else if(o<=2047){if(a+1>=s)break;t[a++]=192|o>>6;t[a++]=128|o&63}else if(o<=65535){if(a+2>=s)break;t[a++]=224|o>>12;t[a++]=128|o>>6&63;t[a++]=128|o&63}else{if(a+3>=s)break;t[a++]=240|o>>18;t[a++]=128|o>>12&63;t[a++]=128|o>>6&63;t[a++]=128|o&63}}t[a]=0;return a-r}function G(e,t,a){return X(e,re,t,a)}function Z(e){var t=0;for(var a=0;a<e.length;++a){var n=e.charCodeAt(a);if(n>=55296&&n<=57343)n=65536+((n&1023)<<10)|e.charCodeAt(++a)&1023;if(n<=127)++t;else if(n<=2047)t+=2;else if(n<=65535)t+=3;else t+=4}return t}var z=typeof TextDecoder!=="undefined"?new TextDecoder("utf-16le"):undefined;function Q(e,t){ne.set(e,t)}function $(e,t,a){for(var n=0;n<e.length;++n){ne[t++>>0]=e.charCodeAt(n)}if(!a)ne[t>>0]=0}var ee=65536;function te(e,t){if(e%t>0){e+=t-e%t}return e}var ae,ne,re,se,ie,oe,ce,le,de;function ue(e){ae=e;i["HEAP8"]=ne=new Int8Array(e);i["HEAP16"]=se=new Int16Array(e);i["HEAP32"]=oe=new Int32Array(e);i["HEAPU8"]=re=new Uint8Array(e);i["HEAPU16"]=ie=new Uint16Array(e);i["HEAPU32"]=ce=new Uint32Array(e);i["HEAPF32"]=le=new Float32Array(e);i["HEAPF64"]=de=new Float64Array(e)}var fe=10877200,_e=10877200,he=5634160;var pe=i["TOTAL_MEMORY"]||16777216;if(i["wasmMemory"]){B=i["wasmMemory"]}else{B=new WebAssembly.Memory({initial:pe/ee})}if(B){ae=B.buffer}pe=ae.byteLength;ue(ae);oe[he>>2]=_e;function ge(e){while(e.length>0){var t=e.shift();if(typeof t=="function"){t();continue}var a=t.func;if(typeof a==="number"){if(t.arg===undefined){i["dynCall_v"](a)}else{i["dynCall_vi"](a,t.arg)}}else{a(t.arg===undefined?null:t.arg)}}}var ye=[];var ve=[];var Ce=[];var ke=[];var me=false;var be=false;function Ee(){if(i["preRun"]){if(typeof i["preRun"]=="function")i["preRun"]=[i["preRun"]];while(i["preRun"].length){Ke(i["preRun"].shift())}}ge(ye)}function we(){me=true;ge(ve)}function Ie(){ge(Ce)}function Se(){be=true}function Re(){if(i["postRun"]){if(typeof i["postRun"]=="function")i["postRun"]=[i["postRun"]];while(i["postRun"].length){Ye(i["postRun"].shift())}}ge(ke)}function Ke(e){ye.unshift(e)}function Ye(e){ke.unshift(e)}var Pe=Math.abs;var Te=Math.ceil;var xe=Math.floor;var Oe=Math.min;var Ae=0;var Fe=null;var Be=null;function De(e){Ae++;if(i["monitorRunDependencies"]){i["monitorRunDependencies"](Ae)}}function Ue(e){Ae--;if(i["monitorRunDependencies"]){i["monitorRunDependencies"](Ae)}if(Ae==0){if(Fe!==null){clearInterval(Fe);Fe=null}if(Be){var t=Be;Be=null;t()}}}i["preloadedImages"]={};i["preloadedAudios"]={};function Me(e){if(i["onAbort"]){i["onAbort"](e)}e+="";k(e);m(e);U=true;M=1;e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.";throw new WebAssembly.RuntimeError(e)}var je="data:application/octet-stream;base64,";function Je(e){return String.prototype.startsWith?e.startsWith(je):e.indexOf(je)===0}var Ne="c64.wasm?v=0.406";if(!Je(Ne)){Ne=_(Ne)}function Le(){try{if(O){return new Uint8Array(O)}if(g){return g(Ne)}else{throw"both async and sync fetching of the wasm failed"}}catch(e){Me(e)}}function He(){if(!O&&(o||c)&&typeof fetch==="function"){return fetch(Ne,{credentials:"same-origin"}).then(function(e){if(!e["ok"]){throw"failed to load wasm binary file at '"+Ne+"'"}return e["arrayBuffer"]()}).catch(function(){return Le()})}return new Promise(function(e,t){e(Le())})}function We(){var a={env:ut,wasi_snapshot_preview1:ut};function t(e,t){var a=e.exports;i["asm"]=a;Ue("wasm-instantiate")}De("wasm-instantiate");function n(e){t(e["instance"])}function r(e){return He().then(function(e){return WebAssembly.instantiate(e,a)}).then(e,function(e){m("failed to asynchronously prepare wasm: "+e);Me(e)})}function e(){if(!O&&typeof WebAssembly.instantiateStreaming==="function"&&!Je(Ne)&&typeof fetch==="function"){fetch(Ne,{credentials:"same-origin"}).then(function(e){var t=WebAssembly.instantiateStreaming(e,a);return t.then(n,function(e){m("wasm streaming compile failed: "+e);m("falling back to ArrayBuffer instantiation");r(n)})})}else{return r(n)}}if(i["instantiateWasm"]){try{var s=i["instantiateWasm"](a,t);return s}catch(e){m("Module.instantiateWasm callback failed with error: "+e);return false}}e();return{}}var Ve;var qe;var Xe={2173:function(e){c64_rasterY(e)},2195:function(e){c64_rasterY(e)},2349:function(){c64_frame()}};var Ge=[];function Ze(e,t){var a=Ge;a.length=0;var n;while(n=re[e++]){if(n===100||n===102){t=t+7&~7;a.push(de[t>>3]);t+=8}else{t=t+3&~3;a.push(oe[t>>2]);t+=4}}return a}function ze(e,t,a){var n=Ze(t,a);return Xe[e].apply(null,n)}ve.push({func:function(){_t()}});function Qe(e){return e}function $e(e){var t=/\b_Z[\w\d_]+/g;return e.replace(t,function(e){var t=Qe(e);return e===t?e:t+" ["+e+"]"})}function et(){var t=new Error;if(!t.stack){try{throw new Error(0)}catch(e){t=e}if(!t.stack){return"(no stack trace available)"}}return t.stack.toString()}function tt(){return ne.length}function at(){return 5634160}function nt(e,t,a){re.set(re.subarray(t,t+a),e)}function rt(e){try{B.grow(e-ae.byteLength+65535>>16);ue(B.buffer);return 1}catch(e){}}function st(e){var t=tt();var a=65536;var n=2147483648-a;if(e>n){return false}var r=16777216;for(var s=1;s<=4;s*=2){var i=t*(1+.2/s);i=Math.min(i,e+100663296);var o=Math.min(n,te(Math.max(r,e,i),a));var c=rt(o);if(c){return true}}return false}var it={splitPath:function(e){var t=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return t.exec(e).slice(1)},normalizeArray:function(e,t){var a=0;for(var n=e.length-1;n>=0;n--){var r=e[n];if(r==="."){e.splice(n,1)}else if(r===".."){e.splice(n,1);a++}else if(a){e.splice(n,1);a--}}if(t){for(;a;a--){e.unshift("..")}}return e},normalize:function(e){var t=e.charAt(0)==="/",a=e.substr(-1)==="/";e=it.normalizeArray(e.split("/").filter(function(e){return!!e}),!t).join("/");if(!e&&!t){e="."}if(e&&a){e+="/"}return(t?"/":"")+e},dirname:function(e){var t=it.splitPath(e),a=t[0],n=t[1];if(!a&&!n){return"."}if(n){n=n.substr(0,n.length-1)}return a+n},basename:function(e){if(e==="/")return"/";var t=e.lastIndexOf("/");if(t===-1)return e;return e.substr(t+1)},extname:function(e){return it.splitPath(e)[3]},join:function(){var e=Array.prototype.slice.call(arguments,0);return it.normalize(e.join("/"))},join2:function(e,t){return it.normalize(e+"/"+t)}};var ot={buffers:[null,[],[]],printChar:function(e,t){var a=ot.buffers[e];if(t===0||t===10){(e===1?k:m)(V(a,0));a.length=0}else{a.push(t)}},varargs:0,get:function(e){ot.varargs+=4;var t=oe[ot.varargs-4>>2];return t},getStr:function(){var e=q(ot.get());return e},get64:function(){var e=ot.get(),t=ot.get();return e},getZero:function(){ot.get()}};function ct(e,t,a,n){try{var r=0;for(var s=0;s<a;s++){var i=oe[t+s*8>>2];var o=oe[t+(s*8+4)>>2];for(var c=0;c<o;c++){ot.printChar(e,re[i+c])}r+=o}oe[n>>2]=r;return 0}catch(e){if(typeof FS==="undefined"||!(e instanceof FS.ErrnoError))Me(e);return e.errno}}function lt(e){x(e|0)}var dt=false;var ut={emscripten_asm_const_iii:ze,emscripten_get_sbrk_ptr:at,emscripten_memcpy_big:nt,emscripten_resize_heap:st,fd_write:ct,memory:B,setTempRet0:lt,table:D};var ft=We();i["asm"]=ft;var _t=i["___wasm_call_ctors"]=function(){return(_t=i["___wasm_call_ctors"]=i["asm"]["__wasm_call_ctors"]).apply(null,arguments)};var ht=i["_c64_setModel"]=function(){return(ht=i["_c64_setModel"]=i["asm"]["c64_setModel"]).apply(null,arguments)};var pt=i["_c64_getModel"]=function(){return(pt=i["_c64_getModel"]=i["asm"]["c64_getModel"]).apply(null,arguments)};var gt=i["_c64_joystick_push"]=function(){return(gt=i["_c64_joystick_push"]=i["asm"]["c64_joystick_push"]).apply(null,arguments)};var yt=i["_c64_joystick_release"]=function(){return(yt=i["_c64_joystick_release"]=i["asm"]["c64_joystick_release"]).apply(null,arguments)};var vt=i["_c64_mouse_position"]=function(){return(vt=i["_c64_mouse_position"]=i["asm"]["c64_mouse_position"]).apply(null,arguments)};var Ct=i["_c64_set_mouse_port_enabled"]=function(){return(Ct=i["_c64_set_mouse_port_enabled"]=i["asm"]["c64_set_mouse_port_enabled"]).apply(null,arguments)};var kt=i["_c64_getPixelBuffer"]=function(){return(kt=i["_c64_getPixelBuffer"]=i["asm"]["c64_getPixelBuffer"]).apply(null,arguments)};var mt=i["_c64_init"]=function(){return(mt=i["_c64_init"]=i["asm"]["c64_init"]).apply(null,arguments)};var bt=i["_c64_reset"]=function(){return(bt=i["_c64_reset"]=i["asm"]["c64_reset"]).apply(null,arguments)};var Et=i["_c64_setColor"]=function(){return(Et=i["_c64_setColor"]=i["asm"]["c64_setColor"]).apply(null,arguments)};var wt=i["_c64_getDriveEnabled"]=function(){return(wt=i["_c64_getDriveEnabled"]=i["asm"]["c64_getDriveEnabled"]).apply(null,arguments)};var It=i["_c64_setDriveEnabled"]=function(){return(It=i["_c64_setDriveEnabled"]=i["asm"]["c64_setDriveEnabled"]).apply(null,arguments)};var St=i["_c64_insertDisk"]=function(){return(St=i["_c64_insertDisk"]=i["asm"]["c64_insertDisk"]).apply(null,arguments)};var Rt=i["_c64_loadPRG"]=function(){return(Rt=i["_c64_loadPRG"]=i["asm"]["c64_loadPRG"]).apply(null,arguments)};var Kt=i["_c64_loadCartridge"]=function(){return(Kt=i["_c64_loadCartridge"]=i["asm"]["c64_loadCartridge"]).apply(null,arguments)};var Yt=i["_c64_removeCartridge"]=function(){return(Yt=i["_c64_removeCartridge"]=i["asm"]["c64_removeCartridge"]).apply(null,arguments)};var Pt=i["_c64_getRasterX"]=function(){return(Pt=i["_c64_getRasterX"]=i["asm"]["c64_getRasterX"]).apply(null,arguments)};var Tt=i["_c64_getRasterY"]=function(){return(Tt=i["_c64_getRasterY"]=i["asm"]["c64_getRasterY"]).apply(null,arguments)};var xt=i["_c64_getVicCycle"]=function(){return(xt=i["_c64_getVicCycle"]=i["asm"]["c64_getVicCycle"]).apply(null,arguments)};var Ot=i["_c64_getPC"]=function(){return(Ot=i["_c64_getPC"]=i["asm"]["c64_getPC"]).apply(null,arguments)};var At=i["_c64_getRegX"]=function(){return(At=i["_c64_getRegX"]=i["asm"]["c64_getRegX"]).apply(null,arguments)};var Ft=i["_c64_getRegY"]=function(){return(Ft=i["_c64_getRegY"]=i["asm"]["c64_getRegY"]).apply(null,arguments)};var Bt=i["_c64_getRegA"]=function(){return(Bt=i["_c64_getRegA"]=i["asm"]["c64_getRegA"]).apply(null,arguments)};var Dt=i["_c64_getSP"]=function(){return(Dt=i["_c64_getSP"]=i["asm"]["c64_getSP"]).apply(null,arguments)};var Ut=i["_c64_getFlagN"]=function(){return(Ut=i["_c64_getFlagN"]=i["asm"]["c64_getFlagN"]).apply(null,arguments)};var Mt=i["_c64_getFlagC"]=function(){return(Mt=i["_c64_getFlagC"]=i["asm"]["c64_getFlagC"]).apply(null,arguments)};var jt=i["_c64_getFlagD"]=function(){return(jt=i["_c64_getFlagD"]=i["asm"]["c64_getFlagD"]).apply(null,arguments)};var Jt=i["_c64_getFlagZ"]=function(){return(Jt=i["_c64_getFlagZ"]=i["asm"]["c64_getFlagZ"]).apply(null,arguments)};var Nt=i["_c64_getFlagV"]=function(){return(Nt=i["_c64_getFlagV"]=i["asm"]["c64_getFlagV"]).apply(null,arguments)};var Lt=i["_c64_getFlagI"]=function(){return(Lt=i["_c64_getFlagI"]=i["asm"]["c64_getFlagI"]).apply(null,arguments)};var Ht=i["_c64_getFlagU"]=function(){return(Ht=i["_c64_getFlagU"]=i["asm"]["c64_getFlagU"]).apply(null,arguments)};var Wt=i["_c64_getFlagB"]=function(){return(Wt=i["_c64_getFlagB"]=i["asm"]["c64_getFlagB"]).apply(null,arguments)};var Vt=i["_c64_setPC"]=function(){return(Vt=i["_c64_setPC"]=i["asm"]["c64_setPC"]).apply(null,arguments)};var qt=i["_c64_setRegX"]=function(){return(qt=i["_c64_setRegX"]=i["asm"]["c64_setRegX"]).apply(null,arguments)};var Xt=i["_c64_setRegY"]=function(){return(Xt=i["_c64_setRegY"]=i["asm"]["c64_setRegY"]).apply(null,arguments)};var Gt=i["_c64_setRegA"]=function(){return(Gt=i["_c64_setRegA"]=i["asm"]["c64_setRegA"]).apply(null,arguments)};var Zt=i["_c64_setFlagN"]=function(){return(Zt=i["_c64_setFlagN"]=i["asm"]["c64_setFlagN"]).apply(null,arguments)};var zt=i["_c64_setFlagC"]=function(){return(zt=i["_c64_setFlagC"]=i["asm"]["c64_setFlagC"]).apply(null,arguments)};var Qt=i["_c64_setFlagD"]=function(){return(Qt=i["_c64_setFlagD"]=i["asm"]["c64_setFlagD"]).apply(null,arguments)};var $t=i["_c64_setFlagZ"]=function(){return($t=i["_c64_setFlagZ"]=i["asm"]["c64_setFlagZ"]).apply(null,arguments)};var ea=i["_c64_setFlagV"]=function(){return(ea=i["_c64_setFlagV"]=i["asm"]["c64_setFlagV"]).apply(null,arguments)};var ta=i["_c64_setFlagI"]=function(){return(ta=i["_c64_setFlagI"]=i["asm"]["c64_setFlagI"]).apply(null,arguments)};var aa=i["_c64_setFlagU"]=function(){return(aa=i["_c64_setFlagU"]=i["asm"]["c64_setFlagU"]).apply(null,arguments)};var na=i["_c64_setFlagB"]=function(){return(na=i["_c64_setFlagB"]=i["asm"]["c64_setFlagB"]).apply(null,arguments)};var ra=i["_c64_getCycleCount"]=function(){return(ra=i["_c64_getCycleCount"]=i["asm"]["c64_getCycleCount"]).apply(null,arguments)};var sa=i["_c64_step"]=function(){return(sa=i["_c64_step"]=i["asm"]["c64_step"]).apply(null,arguments)};var ia=i["_c64_update"]=function(){return(ia=i["_c64_update"]=i["asm"]["c64_update"]).apply(null,arguments)};var oa=i["_c64_getDataLength"]=function(){return(oa=i["_c64_getDataLength"]=i["asm"]["c64_getDataLength"]).apply(null,arguments)};var ca=i["_free"]=function(){return(ca=i["_free"]=i["asm"]["free"]).apply(null,arguments)};var la=i["_malloc"]=function(){return(la=i["_malloc"]=i["asm"]["malloc"]).apply(null,arguments)};var da=i["_c64_getData"]=function(){return(da=i["_c64_getData"]=i["asm"]["c64_getData"]).apply(null,arguments)};var ua=i["_c64_ramWrite"]=function(){return(ua=i["_c64_ramWrite"]=i["asm"]["c64_ramWrite"]).apply(null,arguments)};var fa=i["_c64_ramRead"]=function(){return(fa=i["_c64_ramRead"]=i["asm"]["c64_ramRead"]).apply(null,arguments)};var _a=i["_keyboard_keyPressed"]=function(){return(_a=i["_keyboard_keyPressed"]=i["asm"]["keyboard_keyPressed"]).apply(null,arguments)};var ha=i["_keyboard_keyReleased"]=function(){return(ha=i["_keyboard_keyReleased"]=i["asm"]["keyboard_keyReleased"]).apply(null,arguments)};var pa=i["_c64_vicReadRegister"]=function(){return(pa=i["_c64_vicReadRegister"]=i["asm"]["c64_vicReadRegister"]).apply(null,arguments)};var ga=i["_c64_vicRead"]=function(){return(ga=i["_c64_vicRead"]=i["asm"]["c64_vicRead"]).apply(null,arguments)};var ya=i["_c64_vicReadAbsolute"]=function(){return(ya=i["_c64_vicReadAbsolute"]=i["asm"]["c64_vicReadAbsolute"]).apply(null,arguments)};var va=i["_vic_readNS"]=function(){return(va=i["_vic_readNS"]=i["asm"]["vic_readNS"]).apply(null,arguments)};var Ca=i["_vic_getRegisterAt"]=function(){return(Ca=i["_vic_getRegisterAt"]=i["asm"]["vic_getRegisterAt"]).apply(null,arguments)};var ka=i["_cia1_getRegisterAt"]=function(){return(ka=i["_cia1_getRegisterAt"]=i["asm"]["cia1_getRegisterAt"]).apply(null,arguments)};var ma=i["_cia1_readNS"]=function(){return(ma=i["_cia1_readNS"]=i["asm"]["cia1_readNS"]).apply(null,arguments)};var ba=i["_cia2_getRegisterAt"]=function(){return(ba=i["_cia2_getRegisterAt"]=i["asm"]["cia2_getRegisterAt"]).apply(null,arguments)};var Ea=i["_cia2_readNS"]=function(){return(Ea=i["_cia2_readNS"]=i["asm"]["cia2_readNS"]).apply(null,arguments)};var wa=i["_c64_cpuRead"]=function(){return(wa=i["_c64_cpuRead"]=i["asm"]["c64_cpuRead"]).apply(null,arguments)};var Ia=i["_c64_cpuReadNS"]=function(){return(Ia=i["_c64_cpuReadNS"]=i["asm"]["c64_cpuReadNS"]).apply(null,arguments)};var Sa=i["_c64_cpuWrite"]=function(){return(Sa=i["_c64_cpuWrite"]=i["asm"]["c64_cpuWrite"]).apply(null,arguments)};var Ra=i["_sid_setModel"]=function(){return(Ra=i["_sid_setModel"]=i["asm"]["sid_setModel"]).apply(null,arguments)};var Ka=i["_sid_setSampleRate"]=function(){return(Ka=i["_sid_setSampleRate"]=i["asm"]["sid_setSampleRate"]).apply(null,arguments)};var Ya=i["_sid_dumpBuffer"]=function(){return(Ya=i["_sid_dumpBuffer"]=i["asm"]["sid_dumpBuffer"]).apply(null,arguments)};var Pa=i["_sid_setChannelBuffersEnabled"]=function(){return(Pa=i["_sid_setChannelBuffersEnabled"]=i["asm"]["sid_setChannelBuffersEnabled"]).apply(null,arguments)};var Ta=i["_sid_getAudioBuffer"]=function(){return(Ta=i["_sid_getAudioBuffer"]=i["asm"]["sid_getAudioBuffer"]).apply(null,arguments)};var xa=i["_sid_getAudioBufferCh"]=function(){return(xa=i["_sid_getAudioBufferCh"]=i["asm"]["sid_getAudioBufferCh"]).apply(null,arguments)};var Oa=i["_breakpoints_pcClearAll"]=function(){return(Oa=i["_breakpoints_pcClearAll"]=i["asm"]["breakpoints_pcClearAll"]).apply(null,arguments)};var Aa=i["_breakpoints_pcAdd"]=function(){return(Aa=i["_breakpoints_pcAdd"]=i["asm"]["breakpoints_pcAdd"]).apply(null,arguments)};var Fa=i["_breakpoint_pcSetEnabled"]=function(){return(Fa=i["_breakpoint_pcSetEnabled"]=i["asm"]["breakpoint_pcSetEnabled"]).apply(null,arguments)};var Ba=i["_breakpoint_pcRemove"]=function(){return(Ba=i["_breakpoint_pcRemove"]=i["asm"]["breakpoint_pcRemove"]).apply(null,arguments)};var Da=i["_breakpoints_memoryAdd"]=function(){return(Da=i["_breakpoints_memoryAdd"]=i["asm"]["breakpoints_memoryAdd"]).apply(null,arguments)};var Ua=i["_breakpoint_memorySetEnabled"]=function(){return(Ua=i["_breakpoint_memorySetEnabled"]=i["asm"]["breakpoint_memorySetEnabled"]).apply(null,arguments)};var Ma=i["_breakpoint_memoryRemove"]=function(){return(Ma=i["_breakpoint_memoryRemove"]=i["asm"]["breakpoint_memoryRemove"]).apply(null,arguments)};var ja=i["_breakpoints_rasterYAdd"]=function(){return(ja=i["_breakpoints_rasterYAdd"]=i["asm"]["breakpoints_rasterYAdd"]).apply(null,arguments)};var Ja=i["_breakpoint_rasterYSetEnabled"]=function(){return(Ja=i["_breakpoint_rasterYSetEnabled"]=i["asm"]["breakpoint_rasterYSetEnabled"]).apply(null,arguments)};var Na=i["_breakpoint_rasterYRemove"]=function(){return(Na=i["_breakpoint_rasterYRemove"]=i["asm"]["breakpoint_rasterYRemove"]).apply(null,arguments)};var La=i["_debugger_set_inspect_at"]=function(){return(La=i["_debugger_set_inspect_at"]=i["asm"]["debugger_set_inspect_at"]).apply(null,arguments)};var Ha=i["_debugger_set_speed"]=function(){return(Ha=i["_debugger_set_speed"]=i["asm"]["debugger_set_speed"]).apply(null,arguments)};var Wa=i["_debugger_get_speed"]=function(){return(Wa=i["_debugger_get_speed"]=i["asm"]["debugger_get_speed"]).apply(null,arguments)};var Va=i["_debugger_get_sprite_pointer"]=function(){return(Va=i["_debugger_get_sprite_pointer"]=i["asm"]["debugger_get_sprite_pointer"]).apply(null,arguments)};var qa=i["_debugger_pause"]=function(){return(qa=i["_debugger_pause"]=i["asm"]["debugger_pause"]).apply(null,arguments)};var Xa=i["_debugger_play"]=function(){return(Xa=i["_debugger_play"]=i["asm"]["debugger_play"]).apply(null,arguments)};var Ga=i["_debugger_isRunning"]=function(){return(Ga=i["_debugger_isRunning"]=i["asm"]["debugger_isRunning"]).apply(null,arguments)};var Za=i["_debugger_step"]=function(){return(Za=i["_debugger_step"]=i["asm"]["debugger_step"]).apply(null,arguments)};var za=i["_debugger_update"]=function(){return(za=i["_debugger_update"]=i["asm"]["debugger_update"]).apply(null,arguments)};var Qa=i["_c1541_getStatus"]=function(){return(Qa=i["_c1541_getStatus"]=i["asm"]["c1541_getStatus"]).apply(null,arguments)};var $a=i["_c1541_cpuRead"]=function(){return($a=i["_c1541_cpuRead"]=i["asm"]["c1541_cpuRead"]).apply(null,arguments)};var en=i["_c1541_getPC"]=function(){return(en=i["_c1541_getPC"]=i["asm"]["c1541_getPC"]).apply(null,arguments)};var tn=i["_c1541_getRegX"]=function(){return(tn=i["_c1541_getRegX"]=i["asm"]["c1541_getRegX"]).apply(null,arguments)};var an=i["_c1541_getRegY"]=function(){return(an=i["_c1541_getRegY"]=i["asm"]["c1541_getRegY"]).apply(null,arguments)};var nn=i["_c1541_getRegA"]=function(){return(nn=i["_c1541_getRegA"]=i["asm"]["c1541_getRegA"]).apply(null,arguments)};var rn=i["_c1541_getSP"]=function(){return(rn=i["_c1541_getSP"]=i["asm"]["c1541_getSP"]).apply(null,arguments)};var sn=i["_c1541_getFlagN"]=function(){return(sn=i["_c1541_getFlagN"]=i["asm"]["c1541_getFlagN"]).apply(null,arguments)};var on=i["_c1541_getFlagC"]=function(){return(on=i["_c1541_getFlagC"]=i["asm"]["c1541_getFlagC"]).apply(null,arguments)};var cn=i["_c1541_getFlagD"]=function(){return(cn=i["_c1541_getFlagD"]=i["asm"]["c1541_getFlagD"]).apply(null,arguments)};var ln=i["_c1541_getFlagZ"]=function(){return(ln=i["_c1541_getFlagZ"]=i["asm"]["c1541_getFlagZ"]).apply(null,arguments)};var dn=i["_c1541_getFlagV"]=function(){return(dn=i["_c1541_getFlagV"]=i["asm"]["c1541_getFlagV"]).apply(null,arguments)};var un=i["_c1541_getFlagI"]=function(){return(un=i["_c1541_getFlagI"]=i["asm"]["c1541_getFlagI"]).apply(null,arguments)};var fn=i["_c1541_getFlagU"]=function(){return(fn=i["_c1541_getFlagU"]=i["asm"]["c1541_getFlagU"]).apply(null,arguments)};var _n=i["_c1541_getFlagB"]=function(){return(_n=i["_c1541_getFlagB"]=i["asm"]["c1541_getFlagB"]).apply(null,arguments)};var hn=i["_c1541_getPosition"]=function(){return(hn=i["_c1541_getPosition"]=i["asm"]["c1541_getPosition"]).apply(null,arguments)};var pn=i["_c64_getSnapshotSize"]=function(){return(pn=i["_c64_getSnapshotSize"]=i["asm"]["c64_getSnapshotSize"]).apply(null,arguments)};var gn=i["_c64_getSnapshot"]=function(){return(gn=i["_c64_getSnapshot"]=i["asm"]["c64_getSnapshot"]).apply(null,arguments)};var yn=i["_c64_loadSnapshot"]=function(){return(yn=i["_c64_loadSnapshot"]=i["asm"]["c64_loadSnapshot"]).apply(null,arguments)};var vn=i["___errno_location"]=function(){return(vn=i["___errno_location"]=i["asm"]["__errno_location"]).apply(null,arguments)};var Cn=i["_setThrew"]=function(){return(Cn=i["_setThrew"]=i["asm"]["setThrew"]).apply(null,arguments)};var kn=i["stackSave"]=function(){return(kn=i["stackSave"]=i["asm"]["stackSave"]).apply(null,arguments)};var mn=i["stackAlloc"]=function(){return(mn=i["stackAlloc"]=i["asm"]["stackAlloc"]).apply(null,arguments)};var bn=i["stackRestore"]=function(){return(bn=i["stackRestore"]=i["asm"]["stackRestore"]).apply(null,arguments)};var En=i["__growWasmMemory"]=function(){return(En=i["__growWasmMemory"]=i["asm"]["__growWasmMemory"]).apply(null,arguments)};var wn=i["dynCall_ii"]=function(){return(wn=i["dynCall_ii"]=i["asm"]["dynCall_ii"]).apply(null,arguments)};var In=i["dynCall_vii"]=function(){return(In=i["dynCall_vii"]=i["asm"]["dynCall_vii"]).apply(null,arguments)};var Sn=i["dynCall_vi"]=function(){return(Sn=i["dynCall_vi"]=i["asm"]["dynCall_vi"]).apply(null,arguments)};var Rn=i["dynCall_fifffi"]=function(){return(Rn=i["dynCall_fifffi"]=i["asm"]["dynCall_fifffi"]).apply(null,arguments)};var Kn=i["dynCall_viii"]=function(){return(Kn=i["dynCall_viii"]=i["asm"]["dynCall_viii"]).apply(null,arguments)};var Yn=i["dynCall_iiii"]=function(){return(Yn=i["dynCall_iiii"]=i["asm"]["dynCall_iiii"]).apply(null,arguments)};var Pn=i["dynCall_jiji"]=function(){return(Pn=i["dynCall_jiji"]=i["asm"]["dynCall_jiji"]).apply(null,arguments)};var Tn=i["dynCall_iidiiii"]=function(){return(Tn=i["dynCall_iidiiii"]=i["asm"]["dynCall_iidiiii"]).apply(null,arguments)};i["asm"]=ft;i["ccall"]=N;i["cwrap"]=L;var xn;i["then"]=function(e){if(xn){e(i)}else{var t=i["onRuntimeInitialized"];i["onRuntimeInitialized"]=function(){if(t)t();e(i)}}return i};function On(e){this.name="ExitStatus";this.message="Program terminated with exit("+e+")";this.status=e}Be=function e(){if(!xn)An();if(!xn)Be=e};function An(e){e=e||n;if(Ae>0){return}Ee();if(Ae>0)return;function t(){if(xn)return;xn=true;if(U)return;we();Ie();if(i["onRuntimeInitialized"])i["onRuntimeInitialized"]();Re()}if(i["setStatus"]){i["setStatus"]("Running...");setTimeout(function(){setTimeout(function(){i["setStatus"]("")},1);t()},1)}else{t()}}i["run"]=An;if(i["preInit"]){if(typeof i["preInit"]=="function")i["preInit"]=[i["preInit"]];while(i["preInit"].length>0){i["preInit"].pop()()}}A=true;An();return e}}();if(typeof exports==="object"&&typeof module==="object")module.exports=C64;else if(typeof define==="function"&&define["amd"])define([],function(){return C64});else if(typeof exports==="object")exports["C64"]=C64;var c64_ready=false;var c64_model="pal";var g_c64Settings=typeof g_c64Settings=="undefined"?false:g_c64Settings;var options={};var c64=C64(options);var c64_setModel=c64.cwrap("c64_setModel",null,["number"]);var c64_getModel=c64.cwrap("c64_getModel","number");var c64_cpuRead=c64.cwrap("c64_cpuRead","number",["number"]);var c64_cpuWrite=c64.cwrap("c64_cpuWrite",null,["number","number"]);var c64_cpuReadNS=c64.cwrap("c64_cpuReadNS","number",["number"]);var c64_getPC=c64.cwrap("c64_getPC","number");var c64_getRegX=c64.cwrap("c64_getRegX","number");var c64_getRegY=c64.cwrap("c64_getRegY","number");var c64_getRegA=c64.cwrap("c64_getRegA","number");var c64_getSP=c64.cwrap("c64_getSP","number");var c64_getFlagN=c64.cwrap("c64_getFlagN","number");var c64_getFlagC=c64.cwrap("c64_getFlagC","number");var c64_getFlagD=c64.cwrap("c64_getFlagD","number");var c64_getFlagZ=c64.cwrap("c64_getFlagZ","number");var c64_getFlagV=c64.cwrap("c64_getFlagV","number");var c64_getFlagI=c64.cwrap("c64_getFlagI","number");var c64_getFlagU=c64.cwrap("c64_getFlagU","number");var c64_getFlagB=c64.cwrap("c64_getFlagB","number");var c64_getVicCycle=c64.cwrap("c64_getVicCycle","number");var c64_getRasterY=c64.cwrap("c64_getRasterY","number");var c64_getCycleCount=c64.cwrap("c64_getCycleCount","number",["number"]);var c64_setPC=c64.cwrap("c64_setPC",null,["number"]);var c64_setRegX=c64.cwrap("c64_setRegX",null,["number"]);var c64_setRegY=c64.cwrap("c64_setRegY",null,["number"]);var c64_setRegA=c64.cwrap("c64_setRegA",null,["number"]);var c64_setFlagN=c64.cwrap("c64_setFlagN",null,["number"]);var c64_setFlagC=c64.cwrap("c64_setFlagC",null,["number"]);var c64_setFlagD=c64.cwrap("c64_setFlagD",null,["number"]);var c64_setFlagZ=c64.cwrap("c64_setFlagZ",null,["number"]);var c64_setFlagV=c64.cwrap("c64_setFlagV",null,["number"]);var c64_setFlagI=c64.cwrap("c64_setFlagI",null,["number"]);var c64_setFlagU=c64.cwrap("c64_setFlagU",null,["number"]);var c64_setFlagB=c64.cwrap("c64_setFlagB",null,["number"]);var c64_setColor=c64.cwrap("c64_setColor",null,["number","number"]);var c64_vicRead=c64.cwrap("c64_vicRead","number",["number"]);var c64_vicReadNS=c64.cwrap("vic_readNS","number",["number"]);var c64_vicReadAbsolute=c64.cwrap("c64_vicReadAbsolute","number",["number"]);var c64_vicReadRegister=c64.cwrap("c64_vicReadRegister","number",["number"]);var c64_vicReadRegisterAt=c64.cwrap("vic_getRegisterAt","number",["number","number","number"]);var c64_cia1ReadNS=c64.cwrap("cia1_readNS","number",["number"]);var c64_cia2ReadNS=c64.cwrap("cia2_readNS","number",["number"]);var c64_cia1ReadRegisterAt=c64.cwrap("cia1_getRegisterAt","number",["number","number","number"]);var c64_cia2ReadRegisterAt=c64.cwrap("cia2_getRegisterAt","number",["number","number","number"]);var c64_init=c64.cwrap("c64_init");var c64_reset=c64.cwrap("c64_reset");var c64_getPixelBuffer=c64.cwrap("c64_getPixelBuffer","number");var c64_getData=c64.cwrap("c64_getData","number",["array","number"]);var c64_getDataLength=c64.cwrap("c64_getDataLength","number");var c64_update=c64.cwrap("c64_update");var c64_step=c64.cwrap("c64_step");var c64_loadPRG=c64.cwrap("c64_loadPRG",null,["array","number","number"]);var c64_loadCRT=c64.cwrap("c64_loadCartridge",null,["array","number"]);var c64_removeCartridge=c64.cwrap("c64_removeCartridge");var c64_insertDisk=c64.cwrap("c64_insertDisk",null,["array","number"]);var sid_dumpBuffer=c64.cwrap("sid_dumpBuffer");var debugger_pause=c64.cwrap("debugger_pause");var debugger_isRunning=c64.cwrap("debugger_isRunning");var debugger_play=c64.cwrap("debugger_play");var debugger_set_speed=c64.cwrap("debugger_set_speed");var debugger_step=c64.cwrap("debugger_step");var debugger_update=c64.cwrap("debugger_update","number",["number"]);var c64_debugger_set_inspect_at=c64.cwrap("debugger_set_inspect_at",null,["number","number"]);var c64_debugger_get_sprite_pointer=c64.cwrap("debugger_get_sprite_pointer","number",["number"]);var c64_pcBreakpointAdd=c64.cwrap("breakpoints_pcAdd",null,["number"]);var c64_pcBreakpointSetEnabled=c64.cwrap("breakpoint_pcSetEnabled",null,["number","number"]);var c64_pcBreakpointRemove=c64.cwrap("breakpoint_pcRemove",null,["number"]);var c64_memoryBreakpointAdd=c64.cwrap("breakpoints_memoryAdd",null,["number","number","number"]);var c64_memoryBreakpointSetEnabled=c64.cwrap("breakpoint_memorySetEnabled",null,["number","number","number","number"]);var c64_memoryBreakpointRemove=c64.cwrap("breakpoint_memoryRemove",null,["number","number","number"]);var c64_rasterYBreakpointAdd=c64.cwrap("breakpoints_rasterYAdd",null,["number"]);var c64_rasterYBreakpointSetEnabled=c64.cwrap("breakpoint_rasterYSetEnabled",null,["number","number"]);var c64_rasterYBreakpointRemove=c64.cwrap("breakpoint_rasterYRemove",null,["number"]);var c64_keyPressed=c64.cwrap("keyboard_keyPressed",null,["number"]);var c64_keyReleased=c64.cwrap("keyboard_keyReleased",null,["number"]);var c64_joystickPush=c64.cwrap("c64_joystick_push",null,["number","number"]);var c64_joystickRelease=c64.cwrap("c64_joystick_release",null,["number","number"]);var c64_mousePosition=c64.cwrap("c64_mouse_position",null,["number","number"]);var c64_setMousePortEnabled=c64.cwrap("c64_set_mouse_port_enabled",null,["number","number"]);var c1541_setEnabled=c64.cwrap("c64_setDriveEnabled",null,["number"]);var c1541_getStatus=c64.cwrap("c1541_getStatus","number");var c1541_getPosition=c64.cwrap("c1541_getPosition","number");var c1541_cpuRead=c64.cwrap("c1541_cpuRead","number",["number"]);var c1541_getPC=c64.cwrap("c1541_getPC","number");var c1541_getRegX=c64.cwrap("c1541_getRegX","number");var c1541_getRegY=c64.cwrap("c1541_getRegY","number");var c1541_getRegA=c64.cwrap("c1541_getRegA","number");var c1541_getSP=c64.cwrap("c1541_getSP","number");var c1541_getFlagN=c64.cwrap("c1541_getFlagN","number");var c1541_getFlagC=c64.cwrap("c1541_getFlagC","number");var c1541_getFlagD=c64.cwrap("c1541_getFlagD","number");var c1541_getFlagZ=c64.cwrap("c1541_getFlagZ","number");var c1541_getFlagV=c64.cwrap("c1541_getFlagV","number");var c1541_getFlagI=c64.cwrap("c1541_getFlagI","number");var c1541_getFlagU=c64.cwrap("c1541_getFlagU","number");var c1541_getFlagB=c64.cwrap("c1541_getFlagB","number");var sid_setModel=c64.cwrap("sid_setModel","",["number"]);var sid_setChannelBuffersEnabled=c64.cwrap("sid_setChannelBuffersEnabled","",["number"]);var sid_getAudioBuffer=c64.cwrap("sid_getAudioBuffer","number");var sid_getAudioBufferCh=c64.cwrap("sid_getAudioBufferCh","number");var sid_setSampleRate=c64.cwrap("sid_setSampleRate","number");var c64_getSnapshot=c64.cwrap("c64_getSnapshot","number");var c64_getSnapshotSize=c64.cwrap("c64_getSnapshotSize","number");var c64_loadSnapshot=c64.cwrap("c64_loadSnapshot",null,["array","number"]);c64["onRuntimeInitialized"]=function(){var e=c64_model;if(g_c64Settings!==false){if(typeof g_c64Settings.model!="undefined"){e=g_c64Settings.model}}if(e=="pal"){c64_setModel(1)}else if(e=="ntsc"){c64_setModel(2)}c64_init();c64.pastingText=false;c64.textToPaste=[];c64.colors=new C64Colors;c64.colors.init();c64.joystick=new C64Joystick;c64.joystick.init();c64.sound=new C64Sound;c64.sound.init();if(g_c64Settings!==false){c64.setSettings()}c64_ready=true;c64.colors.setAllColors();if(typeof onC64Ready!="undefined"){onC64Ready()}};c64.setSettings=function(){if(typeof g_c64Settings.colors!="undefined"&&typeof g_c64Settings.colors.length!="undefined"){if(g_c64Settings.colors.length==16){for(var e=0;e<g_c64Settings.colors[e];e++){c64.colors.setColor(e,g_c64Settings.colors[e])}}}if(typeof g_c64Settings.port1!="undefined"){c64.joystick.setPortEnabled(1,g_c64Settings.port1)}if(typeof g_c64Settings.port2!="undefined"){c64.joystick.setPortEnabled(2,g_c64Settings.port2)}if(typeof g_c64Settings.port1Buttons!="undefined"){c64.joystick.setJoystickButtons(0,g_c64Settings.port1Buttons)}if(typeof g_c64Settings.port2Buttons!="undefined"){c64.joystick.setJoystickButtons(1,g_c64Settings.port2Buttons)}if(typeof g_c64Settings.port1Button1Action!="undefined"){c64.joystick.setJoystickButtonAction(0,1,g_c64Settings.port1Button1Action)}if(typeof g_c64Settings.port2Button1Action!="undefined"){c64.joystick.setJoystickButtonAction(1,1,g_c64Settings.port2Button1Action)}if(typeof g_c64Settings.mousePort1!="undefined"){c64.joystick.setMousePortEnabled(1,g_c64Settings.mousePort1)}if(typeof g_c64Settings.mousePort2!="undefined"){c64.joystick.setMousePortEnabled(2,g_c64Settings.mousePort2)}for(var e=0;e<2;e++){var t=e+1;if(typeof g_c64Settings["port"+t]!="undefined"&&g_c64Settings["port"+t]){c64.joystick.setPortEnabled(t,true);if(typeof g_c64Settings["port"+t+"buttons"]!="undefined"){var a=parseInt(g_c64Settings["port"+t+"buttons"],10);c64.joystick.setJoystickButtons(e,a)}if(typeof g_c64Settings["port"+t+"buttonactions"]!="undefined"&&typeof g_c64Settings["port"+t+"buttonactions"].length!="undefined"){var n=g_c64Settings["port"+t+"buttonactions"][1];c64.joystick.setJoystickButtonAction(e,1,n)}}}if(typeof g_c64Settings.sid!="undefined"){c64.sound.setModel(g_c64Settings.sid)}};c64.insertScreenCodes=function(e){c64.textToPaste=[];for(var t=0;t<e.length;t++){c64.textToPaste.push(e[t])}c64.processPasteText()};e:c64.insertText=function(e){c64.textToPaste=[];e=e.toUpperCase();e=e.split("\r\n").join("\n");for(var t=0;t<e.length;t++){var a=e.charCodeAt(t);switch(a){case 10:a=13;break}c64.textToPaste.push(a)}c64.processPasteText()};c64.processPasteText=function(){if(c64.textToPaste.length==0){c64.pastingText=false}c64.pastingText=true;var e=c64_cpuRead(198);if(e!=0){return}var t=631;var a=c64.textToPaste.length;var n=0;var e=a;if(e>8){e=8}c64_cpuWrite(198,e);for(var r=0;r<e;r++){var s=c64.textToPaste.shift();c64_cpuWrite(t++,s)}if(c64.textToPaste.length==0){c64.pastingText=false}};var C64_KEY_ARROW_LEFT=0;var C64_KEY_ONE=1;var C64_KEY_TWO=2;var C64_KEY_THREE=3;var C64_KEY_FOUR=4;var C64_KEY_FIVE=5;var C64_KEY_SIX=6;var C64_KEY_SEVEN=7;var C64_KEY_EIGHT=8;var C64_KEY_NINE=9;var C64_KEY_ZERO=10;var C64_KEY_PLUS=11;var C64_KEY_MINUS=12;var C64_KEY_POUND=13;var C64_KEY_CLEAR_HOME=14;var C64_KEY_INS_DEL=15;var C64_KEY_CTRL=16;var C64_KEY_Q=17;var C64_KEY_W=18;var C64_KEY_E=19;var C64_KEY_R=20;var C64_KEY_T=21;var C64_KEY_Y=22;var C64_KEY_U=23;var C64_KEY_I=24;var C64_KEY_O=25;var C64_KEY_P=26;var C64_KEY_AT=27;var C64_KEY_STAR=28;var C64_KEY_ARROW_UP=29;var C64_KEY_RUN_STOP=30;var C64_KEY_A=31;var C64_KEY_S=32;var C64_KEY_D=33;var C64_KEY_F=34;var C64_KEY_G=35;var C64_KEY_H=36;var C64_KEY_J=37;var C64_KEY_K=38;var C64_KEY_L=39;var C64_KEY_COLON=40;var C64_KEY_SEMICOLON=41;var C64_KEY_EQUALS=42;var C64_KEY_RETURN=43;var C64_KEY_COMMODORE=44;var C64_KEY_SHIFT_LEFT=45;var C64_KEY_Z=46;var C64_KEY_X=47;var C64_KEY_C=48;var C64_KEY_V=49;var C64_KEY_B=50;var C64_KEY_N=51;var C64_KEY_M=52;var C64_KEY_COMMA=53;var C64_KEY_PERIOD=54;var C64_KEY_SLASH=55;var C64_KEY_SHIFT_RIGHT=56;var C64_KEY_CURSOR_UP_DOWN=57;var C64_KEY_CURSOR_LEFT_RIGHT=58;var C64_KEY_SPACE=59;var C64_KEY_F1=60;var C64_KEY_F3=61;var C64_KEY_F5=62;var C64_KEY_F7=63;var C64_KEY_RESTORE=64;var C64_JOYSTICK_UP=1;var C64_JOYSTICK_DOWN=2;var C64_JOYSTICK_LEFT=4;var C64_JOYSTICK_RIGHT=8;var C64_JOYSTICK_FIRE=16;var keyDownMap={};var joystickEnabled=true;function shiftedKey(e,t,a){if(a=="keydown"){c64_keyPressed(C64_KEY_SHIFT_LEFT)}else{c64_keyReleased(C64_KEY_SHIFT_LEFT)}if(a=="keyup"){e=keyDownMap["kc"+t]}return e}function nonShiftedKey(e){c64_keyReleased(C64_KEY_SHIFT_LEFT);c64_keyReleased(C64_KEY_SHIFT_RIGHT);return e}function keyCodeToMatrixIndex(e,t){var a=t.type.toLowerCase();var n=false;if(a=="keydown"){if(t.shiftKey){c64_keyPressed(C64_KEY_SHIFT_LEFT)}else{if(e!=38&&e!=37){c64_keyReleased(C64_KEY_SHIFT_RIGHT);c64_keyReleased(C64_KEY_SHIFT_LEFT)}}if(typeof keyDownMap["kc"+e]!="undefined"&&keyDownMap["kc"+e]!==false){return false}}t.preventDefault();if(typeof t.key!="undefined"){var r=t.key.toLowerCase();switch(r){case"enter":n=43;break;case" ":n=59;break;case"`":n=C64_KEY_ARROW_LEFT;break;case"~":n=C64_KEY_ARROW_UP;if(a=="keyup"){n=keyDownMap["kc"+e]}break;case"1":n=1;break;case"2":n=2;break;case"3":n=3;break;case"4":n=4;break;case"5":n=5;break;case"6":n=6;break;case"7":n=7;break;case"8":n=8;break;case"9":n=9;break;case"0":n=10;break;case"\\":n=C64_KEY_POUND;break;case"-":n=12;break;case"backspace":case"delete":n=15;break;case"tab":n=C64_KEY_CTRL;break;case"control":n=C64_KEY_COMMODORE;break;case"q":n=17;break;case"w":n=18;break;case"e":n=19;break;case"r":n=20;break;case"t":n=21;break;case"y":n=22;break;case"u":n=23;break;case"i":n=24;break;case"o":n=25;break;case"p":n=26;break;case"escape":n=30;break;case"a":n=31;break;case"s":n=32;break;case"d":n=33;break;case"f":n=34;break;case"g":n=35;break;case"h":n=36;break;case"j":n=37;break;case"k":n=38;break;case"l":n=39;break;case":":n=C64_KEY_COLON;if(a=="keydown"){c64_keyReleased(C64_KEY_SHIFT_LEFT);c64_keyReleased(C64_KEY_SHIFT_RIGHT)}break;case";":n=C64_KEY_SEMICOLON;break;case"[":n=C64_KEY_COLON;if(a=="keydown"){c64_keyPressed(C64_KEY_SHIFT_LEFT)}else{c64_keyReleased(C64_KEY_SHIFT_LEFT)}if(a=="keyup"){n=keyDownMap["kc"+e]}break;case"]":n=C64_KEY_SEMICOLON;if(a=="keydown"){c64_keyPressed(C64_KEY_SHIFT_LEFT)}else{c64_keyReleased(C64_KEY_SHIFT_LEFT)}if(a=="keyup"){n=keyDownMap["kc"+e]}break;case"=":n=42;break;case"capslock":n=44;break;case"z":n=46;break;case"x":n=47;break;case"c":n=48;break;case"v":n=49;break;case"b":n=50;break;case"n":n=51;break;case"m":n=52;break;case",":case"<":n=C64_KEY_COMMA;break;case".":case">":n=C64_KEY_PERIOD;break;case"/":case"?":n=C64_KEY_SLASH;break;case"arrowup":n=C64_KEY_CURSOR_UP_DOWN;if(a=="keydown"){c64_keyPressed(C64_KEY_SHIFT_LEFT)}else{c64_keyReleased(C64_KEY_SHIFT_LEFT)}if(a=="keyup"){n=keyDownMap["kc"+e]}break;case"arrowdown":n=C64_KEY_CURSOR_UP_DOWN;break;case"arrowleft":n=C64_KEY_CURSOR_LEFT_RIGHT;if(a=="keydown"){c64_keyPressed(C64_KEY_SHIFT_LEFT)}else{c64_keyReleased(C64_KEY_SHIFT_LEFT)}if(a=="keyup"){n=keyDownMap["kc"+e]}break;case"arrowright":n=C64_KEY_CURSOR_LEFT_RIGHT;break;case"!":n=shiftedKey(C64_KEY_ONE,e,a);break;case'"':n=shiftedKey(C64_KEY_TWO,e,a);break;case"#":n=shiftedKey(C64_KEY_THREE,e,a);break;case"$":n=shiftedKey(C64_KEY_FOUR,e,a);break;case"%":n=shiftedKey(C64_KEY_FIVE,e,a);break;case"&":n=shiftedKey(C64_KEY_SIX,e,a);break;case"'":n=shiftedKey(C64_KEY_SEVEN,e,a);break;case"(":n=shiftedKey(C64_KEY_EIGHT,e,a);break;case")":n=shiftedKey(C64_KEY_NINE,e,a);break;case"@":n=nonShiftedKey(C64_KEY_AT);break;case"^":n=nonShiftedKey(C64_KEY_ARROW_UP);break;case"*":n=nonShiftedKey(C64_KEY_STAR);break;case"+":n=nonShiftedKey(C64_KEY_PLUS);break;case"f1":n=C64_KEY_F1;break;case"f2":n=C64_KEY_F1;if(a=="keydown"){c64_keyPressed(C64_KEY_SHIFT_LEFT)}else{c64_keyReleased(C64_KEY_SHIFT_LEFT)}if(a=="keyup"){n=keyDownMap["kc"+e]}break;case"f3":n=C64_KEY_F3;break;case"f4":n=C64_KEY_F3;if(a=="keydown"){c64_keyPressed(C64_KEY_SHIFT_LEFT)}else{c64_keyReleased(C64_KEY_SHIFT_LEFT)}if(a=="keyup"){n=keyDownMap["kc"+e]}break;case"f5":n=C64_KEY_F5;break;case"f6":n=C64_KEY_F5;if(a=="keydown"){c64_keyPressed(C64_KEY_SHIFT_LEFT)}else{c64_keyReleased(C64_KEY_SHIFT_LEFT)}break;case"f7":n=C64_KEY_F7;break;case"f8":n=C64_KEY_F7;if(a=="keydown"){c64_keyPressed(C64_KEY_SHIFT_LEFT)}else{c64_keyReleased(C64_KEY_SHIFT_LEFT)}break;case"shift":n=45;break}}if(a=="keydown"){keyDownMap["kc"+e]=n}else{keyDownMap["kc"+e]=false}return n}function c64_keydown(e){e.preventDefault();var t=e.keyCode;var a=this.keyCodeToMatrixIndex(t,e);if(a===false){return}c64_keyPressed(a)}function c64_keyup(e){e.preventDefault();var t=e.keyCode;var a=this.keyCodeToMatrixIndex(t,e);if(a===false){return}c64_keyReleased(a)}function c64_frame(){if(c64.scripting){c64.scripting.scriptProcessor.triggerEvent("c64.frame")}}function c64_rasterY(e){if(c64.scripting){}}var D64Util={};D64Util.trackInfo=[{track:0,numSectors:0,sectorsIn:0,d64Offset:0},{track:1,numSectors:21,sectorsIn:0,d64Offset:0},{track:2,numSectors:21,sectorsIn:21,d64Offset:5376},{track:3,numSectors:21,sectorsIn:42,d64Offset:10752},{track:4,numSectors:21,sectorsIn:63,d64Offset:16128},{track:5,numSectors:21,sectorsIn:84,d64Offset:21504},{track:6,numSectors:21,sectorsIn:105,d64Offset:26880},{track:7,numSectors:21,sectorsIn:126,d64Offset:32256},{track:8,numSectors:21,sectorsIn:147,d64Offset:37632},{track:9,numSectors:21,sectorsIn:168,d64Offset:43008},{track:10,numSectors:21,sectorsIn:189,d64Offset:48384},{track:11,numSectors:21,sectorsIn:210,d64Offset:53760},{track:12,numSectors:21,sectorsIn:231,d64Offset:59136},{track:13,numSectors:21,sectorsIn:252,d64Offset:64512},{track:14,numSectors:21,sectorsIn:273,d64Offset:69888},{track:15,numSectors:21,sectorsIn:294,d64Offset:75264},{track:16,numSectors:21,sectorsIn:315,d64Offset:80640},{track:17,numSectors:21,sectorsIn:336,d64Offset:86016},{track:18,numSectors:19,sectorsIn:357,d64Offset:91392},{track:19,numSectors:19,sectorsIn:376,d64Offset:96256},{track:20,numSectors:19,sectorsIn:395,d64Offset:101120},{track:21,numSectors:19,sectorsIn:414,d64Offset:105984},{track:22,numSectors:19,sectorsIn:433,d64Offset:110848},{track:23,numSectors:19,sectorsIn:452,d64Offset:115712},{track:24,numSectors:19,sectorsIn:471,d64Offset:120576},{track:25,numSectors:18,sectorsIn:490,d64Offset:125440},{track:26,numSectors:18,sectorsIn:508,d64Offset:130048},{track:27,numSectors:18,sectorsIn:526,d64Offset:134656},{track:28,numSectors:18,sectorsIn:544,d64Offset:139264},{track:29,numSectors:18,sectorsIn:562,d64Offset:143872},{track:30,numSectors:18,sectorsIn:580,d64Offset:148480},{track:31,numSectors:17,sectorsIn:598,d64Offset:153088},{track:32,numSectors:17,sectorsIn:615,d64Offset:157440},{track:33,numSectors:17,sectorsIn:632,d64Offset:161792},{track:34,numSectors:17,sectorsIn:649,d64Offset:166144},{track:35,numSectors:17,sectorsIn:666,d64Offset:170496},{track:36,numSectors:17,sectorsIn:683,d64Offset:174848},{track:37,numSectors:17,sectorsIn:700,d64Offset:179200},{track:38,numSectors:17,sectorsIn:717,d64Offset:183552},{track:39,numSectors:17,sectorsIn:734,d64Offset:187904},{track:40,numSectors:17,sectorsIn:751,d64Offset:192256}];D64Util.getOffset=function(e,t){return D64Util.trackInfo[e].d64Offset+t*256};D64Util.d64ReadFile=function(e,t,a){var n=[];while(1){var r=D64Util.getOffset(t,a);var s=e[r+0];var i=e[r+1];var o=254;if(s==0){o=i-1}for(var c=0;c<o;c++){n.push(e[r+c+2])}if(s==0){break}t=s;a=i}return new Uint8Array(n)};D64Util.getFirstPRG=function(e){var t=D64Util.readDirectory(e);var a=false;for(var n=0;n<t.length;n++){if(t[n].type=="prg"){a=n;break}}if(a===false){return null}var r=D64Util.d64ReadFile(e,t[a].track,t[a].sector);return r};D64Util.readDirectory=function(e){var t=[];var a=18;var n=1;while(a!=0){var r=D64Util.getOffset(a,n);var s=r;for(var i=0;i<8;i++,s+=32){var o=e[s+2];console.log("file type = "+o);if(o==0){continue}switch(o&7){case 0:o="del";break;case 1:o="seq";break;case 2:o="prg";break;case 3:o="usr";break;case 4:o="rel";break;default:o="unk";break}var c=e.slice(s+5,s+21);var l=e[s+3];var d=e[s+4];var u=e[s+31]*256+e[s+30];var f="";for(var i=0;i<c.length;i++){f+=String.fromCharCode(c[i])}t.push({type:o,name:f,d64FileOffset:s+5,track:l,sector:d,sectors:u})}a=e[r+0];n=e[r+1];console.log("de track = "+a+":"+n);if(a==0){break}}console.log(t);return t};if(window.performance&&window.performance.now){getTimestamp=function(){return window.performance.now()}}else{if(window.performance&&window.performance.webkitNow){getTimestamp=function(){return window.performance.webkitNow()}}else{getTimestamp=function(){return(new Date).getTime()}}}var g_started=false;var g_lastUpdate=getTimestamp();function base64ToBuffer(e){var t=atob(e);var a=new Uint8Array(t.length);for(var n=0,r=a.length;n<r;n++){a[n]=t.charCodeAt(n)}return a}var isMobileBrowser={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)||navigator.userAgent.match(/WPDesktop/i)},any:function(){return isMobileBrowser.Android()||isMobileBrowser.BlackBerry()||isMobileBrowser.iOS()||isMobileBrowser.Opera()||isMobileBrowser.Windows()}};var offscreenCanvas=document.createElement("canvas");offscreenCanvas.width=384;offscreenCanvas.height=272;var offscreenContext=offscreenCanvas.getContext("2d");var imageData=offscreenContext.getImageData(0,0,offscreenCanvas.width,offscreenCanvas.height);var mouseInCanvas=false;var mouseC64X=0;var mouseC64Y=0;var canvas=document.getElementById("c64-canvas");canvas.width=384;canvas.height=272;var context=canvas.getContext("2d");var isMobile=isMobileBrowser.any();var orientation=0;if(isMobile){orientation=window.innerWidth>window.innerHeight?90:0}var isFullscreen=false;var onScreenJoystick=null;var onScreenKeyboard=null;var overlayOnscreenJoystick=null;var currentOnscreenControl="joystick";var arrowKeysImage=new Image;arrowKeysImage.src="images/arrowkeys.png";var zKeyImage=new Image;zKeyImage.src="images/zkey.png";var xKeyImage=new Image;xKeyImage.src="images/xkey.png";var controlsImage=new Image;controlsImage.src="images/controls.png";var orGamepadImage=new Image;orGamepadImage.src="images/orgamepad.png";var plusImage=new Image;plusImage.src="images/orgamepad.png";var injectPRG=false;var prgRandomDelay=false;var c64Scale=1;var userAgent=window.navigator.userAgent;var platform=window.navigator.platform;var macosPlatforms=["Macintosh","MacIntel","MacPPC","Mac68K"];var windowsPlatforms=["Win32","Win64","Windows","WinCE"];var iosPlatforms=["iPhone","iPad","iPod"];var os=null;if(macosPlatforms.indexOf(platform)!==-1){os="Mac OS"}else if(iosPlatforms.indexOf(platform)!==-1){os="iOS"}else if(windowsPlatforms.indexOf(platform)!==-1){os="Windows"}else if(/Android/.test(userAgent)){os="Android"}else if(!os&&/Linux/.test(platform)){os="Linux"}canvas.style.cursor="pointer";document.addEventListener("keydown",function(e){if(c64_ready){if(c64.joystick.keyDown(e)){return}c64_keydown(e)}},false);document.addEventListener("keyup",function(e){if(c64_ready){if(c64.joystick.keyUp(e)){return}c64_keyup(e)}},false);canvas.addEventListener("contextmenu",function(e){e.preventDefault()});canvas.addEventListener("mousedown",function(e){if(!g_started){startContent()}else{mouseDown(e)}});canvas.addEventListener("mouseup",function(e){mouseUp(e)});canvas.addEventListener("mousemove",function(e){mouseMove(e)});canvas.addEventListener("mouseenter",function(e){mouseInCanvas=true});canvas.addEventListener("mouseleave",function(e){mouseInCanvas=false});window.addEventListener("resize",function(e){resize()});document.getElementById("c64-holder").addEventListener("fullscreenchange",function(e){if(document.fullscreenElement){}else{isFullscreen=false;if(isMobile){g_started=false}resize()}});var fullscreenButton=document.getElementById("c64-fullscreen");if(fullscreenButton){fullscreenButton.addEventListener("click",function(e){fullscreen()})}window.addEventListener("orientationchange",function(e){});function setupOnscreenControls(){onScreenJoystick=new C64OnscreenJoystick;onScreenJoystick.initEvents();overlayOnscreenJoystick=new C64OnscreenJoystick;overlayOnscreenJoystick.id="c64-overlay-onscreen-joystick";overlayOnscreenJoystick.initEvents();onScreenKeyboard=new C64OnscreenKeyboard;onScreenKeyboard.loadFont();onScreenKeyboard.initKeyboard();onScreenKeyboard.initEvents();var t=document.getElementById("c64-onscreen-keyboard-tab");var a=document.getElementById("c64-onscreen-joystick-tab");t.addEventListener("click",function(e){t.className="tab tab-current";a.className="tab";currentOnscreenControl="keyboard";resize()});a.addEventListener("click",function(e){t.className="tab";a.className="tab tab-current";currentOnscreenControl="joystick";resize()});if(g_c64Settings.mobileJoystick){currentOnscreenControl="joystick"}else if(g_c64Settings.mobileKeyboard){currentOnscreenControl="keyboard"}for(var e=0;e<2;e++){var n=e+1;if(typeof g_c64Settings["port"+n]!="undefined"&&g_c64Settings["port"+n]){onScreenJoystick.setPort(n);overlayOnscreenJoystick.setPort(n);if(typeof g_c64Settings["port"+n+"buttons"]!="undefined"){var r=parseInt(g_c64Settings["port"+n+"buttons"],10);onScreenJoystick.setType(r);overlayOnscreenJoystick.setType(r)}if(typeof g_c64Settings["port"+n+"buttonactions"]!="undefined"&&typeof g_c64Settings["port"+n+"buttonactions"].length!="undefined"){var s=g_c64Settings["port"+n+"buttonactions"][1];onScreenJoystick.setSecondButton(s);overlayOnscreenJoystick.setSecondButton(s)}}}}function layoutMobile(){resize()}function startContent(){c64.sound.checkAudio();canvas.style.cursor="none";if(isMobile){fullscreen();layoutMobile()}c64_reset();if(typeof g_prg!="undefined"&&g_prg){if(typeof g_c64Settings!="undefined"&&g_c64Settings.prgLoadMethod!="undefined"){injectPRG=g_c64Settings.prgLoadMethod=="inject"}if(typeof g_c64Settings!="undefined"&&g_c64Settings.prgLoadMethod!="undefined"){prgRandomDelay=g_c64Settings.prgRandomDelay}var e=base64ToBuffer(g_prg);var t=1;if(prgRandomDelay){t=Math.random()*100}setTimeout(function(){c64_loadPRG(e,e.length,injectPRG);if(injectPRG){c64.insertText("run:\n")}else{setTimeout(function(){c64.insertText('load "*",8,1\nrun\n')},2e3)}},t)}if(typeof g_d64!="undefined"&&g_d64){var a=base64ToBuffer(g_d64);c64_insertDisk(a,a.length);setTimeout(function(){c64.insertText('load "*",8,1\nrun\n')},2e3)}if(typeof g_crt!="undefined"&&g_crt){var n=base64ToBuffer(g_crt);c64_loadCRT(n,n.length)}if(typeof g_snapshot!="undefined"&&g_snapshot){var r=base64ToBuffer(g_snapshot);c64_loadSnapshot(r,r.length)}g_started=true}function reset(){c64_reset()}function mouseMove(e){var t=this.canvas.getBoundingClientRect();var a=t.left+document.body.scrollLeft;var n=t.top+document.body.scrollTop;var r=e.pageX-a;var s=e.pageY-n;r=Math.floor(r/c64Scale);s=Math.floor(s/c64Scale);mouseC64X=r;mouseC64Y=s+15}LEFTMOUSEBUTTON=1;RIGHTMOUSEBUTTON=2;MIDDLEMOUSEBUTTON=4;function setButtons(e){if(typeof e.buttons!="undefined"){buttons=e.buttons}else{if(typeof e.which!=="undefined"){buttons=e.which}else if(typeof e.nativeEvent!=="undefined"){if(typeof e.nativeEvent.which!="undefined"){buttons=e.nativeEvent.which}if(typeof e.nativeEvent.buttons!="undefined"){buttons=e.nativeEvent.buttons}}}if(typeof e.touches!="undefined"&&e.touches.length==1){buttons=LEFTMOUSEBUTTON}if(e.ctrlKey&&buttons&LEFTMOUSEBUTTON){if(os=="Mac OS"){buttons=UI.RIGHTMOUSEBUTTON}}}function mouseDown(e){setButtons(e);for(var t=0;t<2;t++){if(c64.joystick.getMousePortEnabled(t)){e.preventDefault();if(buttons&LEFTMOUSEBUTTON){c64_joystickPush(t,C64_JOYSTICK_FIRE)}if(buttons&RIGHTMOUSEBUTTON){c64_joystickPush(t,C64_JOYSTICK_UP)}}}}function mouseUp(e){for(var t=0;t<2;t++){if(c64.joystick.getMousePortEnabled(t)){e.preventDefault();if(buttons&LEFTMOUSEBUTTON){c64_joystickRelease(t,C64_JOYSTICK_FIRE)}if(buttons&RIGHTMOUSEBUTTON){c64_joystickRelease(t,C64_JOYSTICK_UP)}}}}function redraw(){var e=c64_getPixelBuffer();var t=384*272*4;var a=new Uint8Array(c64.HEAPU8.subarray(e,e+t));var n=imageData.data;n.set(a);offscreenContext.putImageData(imageData,0,0);context.drawImage(offscreenCanvas,0,0,offscreenCanvas.width,offscreenCanvas.height,0,0,canvas.width,canvas.height);if(!g_started){var r=canvas.width;var s=canvas.height;var i=50;var o=60;if(canvas.width<400){i=25;o=30}var c=Math.floor((r-i)/2);var l=Math.floor((s-o)/2);if(mouseInCanvas){context.fillStyle="#ffffff"}else{context.fillStyle="#cccccc"}context.beginPath();context.moveTo(c,l);context.lineTo(c+i,l+o/2);context.lineTo(c,l+o);context.fill();if(g_c64Settings.mobileJoystick&&!isMobile&&typeof arrowKeysImage.naturalWidth!="undefined"){context.filter="brightness(90%)";var d=1;if(canvas.width<400){d=.5}var u=Math.floor(r/2);var f=60*d;var _=30*d;var h=l+o+f;var p=u-controlsImage.naturalWidth*d-_;var g=h;g+=30*d;context.drawImage(controlsImage,p,g,controlsImage.naturalWidth*d,controlsImage.naturalHeight*d);if(c64.joystick.hasGamepad()){var y=u+_;var v=h+(arrowKeysImage.naturalHeight+12)*d;context.drawImage(orGamepadImage,y,v,orGamepadImage.naturalWidth*d,orGamepadImage.naturalHeight*d)}var C=u+_;var k=h;context.drawImage(arrowKeysImage,C,k,arrowKeysImage.naturalWidth*d,arrowKeysImage.naturalHeight*d);var m=u+arrowKeysImage.naturalWidth*d+_*2;var b=l+o+f+32*d;context.drawImage(zKeyImage,m,b,zKeyImage.naturalWidth*d,zKeyImage.naturalHeight*d);if(c64.joystick.getJoystickButtons(0)>1||c64.joystick.getJoystickButtons(1)>1){var E=u+arrowKeysImage.naturalWidth*d+zKeyImage.naturalWidth*d+_*2.2;var w=l+o+f+32*d;context.drawImage(xKeyImage,E,w,xKeyImage.naturalWidth*d,xKeyImage.naturalHeight*d)}}context.filter="none"}}function showControls(){console.log("SHOW CONTROLs")}function fullscreen(){isFullscreen=true;var e=document.getElementById("c64-holder");if(e.requestFullscreen){e.requestFullscreen()}else if(e.mozRequestFullScreen){e.mozRequestFullScreen()}else if(e.webkitRequestFullscreen){e.webkitRequestFullscreen()}else if(e.msRequestFullscreen){e.msRequestFullscreen()}if(isMobile){setupOnscreenControls()}resize()}function onC64Ready(){}function resize(){var e=true;var t=384;var a=272;var n=document.getElementById("c64-holder");var r=n.clientWidth;var s=n.clientHeight;if(isMobile){var i=document.getElementById("c64-onscreen-tabs");var o=document.getElementById("c64-onscreen-joystick");var c=document.getElementById("c64-onscreen-keyboard");var l=document.getElementById("c64-overlay-onscreen-joystick");if(isFullscreen){var d=210;var u=40;if(orientation==90){d=0;u=0}s=s-d-u;if(g_c64Settings.mobileKeyboard&&g_c64Settings.mobileJoystick){if(u==0){i.style.display="none"}else{i.style.bottom=d+"px";i.style.height=u+"px";i.style.display="block"}}o.style.height=d+"px";if(g_c64Settings.mobileJoystick&&currentOnscreenControl=="joystick"&&d>0){o.style.display="block"}else{o.style.display="none"}c.style.height=d+"px";if(g_c64Settings.mobileKeyboard&&currentOnscreenControl=="keyboard"&&d>0){c.style.display="block"}else{c.style.display="none"}if(orientation!=0&&g_c64Settings.mobileJoystick){l.style.display="block";overlayOnscreenJoystick.draw()}else{l.style.display="none"}}else{i.style.display="none";o.style.display="none";c.style.display="none";l.style.display="none"}}var f=1;var _=window.devicePixelRatio;var h=isMobile;var p=r/t;var g=s/a;if(p>g){f=g}else{f=p}if(f>1&&e&&!h){f=Math.floor(f)}var y=Math.round(t*f);var v=Math.round(a*f);c64Scale=f;if(h){canvas.width=Math.round(t*f*_);canvas.height=Math.round(a*f*_);canvas.style.width=y+"px";canvas.style.height=v+"px"}else{canvas.width=Math.round(t*f);canvas.height=Math.round(a*f)}context=canvas.getContext("2d");var C=Math.floor((s-v)/2);var k=Math.floor((r-y)/2);canvas.style.top=C+"px";canvas.style.left=k+"px";if(f>=1&&(e||h)){context.imageSmoothingEnabled=false;context.webkitImageSmoothingEnabled=false;context.mozImageSmoothingEnabled=false;context.msImageSmoothingEnabled=false;context.oImageSmoothingEnabled=false}else{context.imageSmoothingEnabled=true;context.webkitImageSmoothingEnabled=true;context.mozImageSmoothingEnabled=true;context.msImageSmoothingEnabled=true;context.oImageSmoothingEnabled=true}var m=document.getElementById("c64-fullscreen-holder");if(m){if(isMobile){m.style.display="none"}else{var k=k+y-18;var C=C+v+2;m.style.display="block";m.style.left=k+"px";m.style.top=C+"px"}}if(isMobile&&orientation!=0&&isFullscreen){var b=Math.floor((r-y)/2);var E=Math.floor((b-40)/2);if(E<70){E=70}overlayOnscreenJoystick.maxRadius=E;overlayOnscreenJoystick.draw()}if(c64_ready){redraw()}}function render(e){var t=e-g_lastUpdate;g_lastUpdate=e;if(onScreenJoystick){onScreenJoystick.draw()}if(onScreenKeyboard){onScreenKeyboard.draw()}if(c64_ready){c64.joystick.checkGamepads();c64_mousePosition(mouseC64X,mouseC64Y);if(c64.pastingText){c64.processPasteText()}if(isMobile){var a=window.innerWidth>window.innerHeight?90:0;if(a!=orientation){orientation=a;layoutMobile()}}if(debugger_update(t)||!debugger_isRunning()){redraw()}}requestAnimationFrame(render)}render();resize();